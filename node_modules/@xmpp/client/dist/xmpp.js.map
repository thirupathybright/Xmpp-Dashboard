{"version":3,"file":"xmpp.js","sources":["../../../node_modules/ltx/lib/escape.js","../../../node_modules/ltx/lib/Element.js","../../../node_modules/ltx/lib/createElement.js","../../../node_modules/events/events.js","../../../node_modules/ltx/lib/parsers/ltx.js","../../events/lib/TimeoutError.js","../../events/lib/timeout.js","../../events/lib/delay.js","../../events/lib/onoff.js","../../events/lib/promise.js","../../events/lib/Deferred.js","../../events/lib/procedure.js","../../events/lib/listeners.js","../../xml/lib/XMLError.js","../../xml/lib/Parser.js","../../xml/index.js","../../jid/lib/escaping.js","../../jid/lib/JID.js","../../jid/lib/parse.js","../../jid/index.js","../../error/index.js","../../connection/lib/StreamError.js","../../connection/lib/util.js","../../connection/index.js","../../client-core/lib/Client.js","../../reconnect/index.js","../../websocket/lib/Socket.js","../../websocket/lib/Connection.js","../../websocket/lib/FramedParser.js","../../../node_modules/koa-compose/index.js","../../middleware/lib/Context.js","../../middleware/lib/IncomingContext.js","../../middleware/lib/OutgoingContext.js","../../middleware/index.js","../../middleware/lib/StanzaError.js","../../iq/caller.js","../../id/index.js","../../iq/callee.js","../../resolve/lib/alt-connections.js","../../resolve/lib/http.js","../../xml/lib/parse.js","../../resolve/index.js","../../resolve/resolve.js","../../base64/index.js","../../sasl/lib/SASLError.js","../../sasl/index.js","../../sasl2/index.js","../../resource-binding/index.js","../../time/index.js","../../stream-management/stream-feature.js","../../stream-management/index.js","../../stream-management/bind2.js","../../stream-management/sasl2.js","../../client-core/src/bind2/bind2.js","../../../node_modules/saslmechanisms/main.js","../../../node_modules/saslmechanisms/lib/factory.js","../../client-core/src/fast/fast.js","../../../node_modules/sasl-plain/main.js","../../../node_modules/sasl-plain/lib/mechanism.js","../../sasl-plain/index.js","../../../node_modules/sasl-anonymous/main.js","../../../node_modules/sasl-anonymous/lib/mechanism.js","../../sasl-anonymous/index.js","../../sasl-ht-sha-256-none/index.js","../lib/createOnAuthenticate.js","../index.js","../lib/getDomain.js","../../websocket/index.js","../../stream-features/index.js"],"sourcesContent":["'use strict';\n\nconst escapeXMLTable = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&apos;\",\n};\n\nfunction escapeXMLReplace(match) {\n  return escapeXMLTable[match];\n}\n\nconst unescapeXMLTable = {\n  \"&amp;\": \"&\",\n  \"&lt;\": \"<\",\n  \"&gt;\": \">\",\n  \"&quot;\": '\"',\n  \"&apos;\": \"'\",\n};\n\nfunction unescapeXMLReplace(match) {\n  if (match[1] === \"#\") {\n    const num =\n      match[2] === \"x\"\n        ? parseInt(match.slice(3), 16)\n        : parseInt(match.slice(2), 10);\n    // https://www.w3.org/TR/xml/#NT-Char defines legal XML characters:\n    // #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]\n    if (\n      num === 0x9 ||\n      num === 0xa ||\n      num === 0xd ||\n      (num >= 0x20 && num <= 0xd7ff) ||\n      (num >= 0xe000 && num <= 0xfffd) ||\n      (num >= 0x10000 && num <= 0x10ffff)\n    ) {\n      return String.fromCodePoint(num);\n    }\n    throw new Error(\"Illegal XML character 0x\" + num.toString(16));\n  }\n  if (unescapeXMLTable[match]) {\n    return unescapeXMLTable[match] || match;\n  }\n  throw new Error(\"Illegal XML entity \" + match);\n}\n\nfunction escapeXML(s) {\n  return s.replace(/[\"&'<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXML(s) {\n  let result = \"\";\n  let start = -1;\n  let end = -1;\n  let previous = 0;\n  while (\n    (start = s.indexOf(\"&\", previous)) !== -1 &&\n    (end = s.indexOf(\";\", start + 1)) !== -1\n  ) {\n    result =\n      result +\n      s.slice(previous, start) +\n      unescapeXMLReplace(s.slice(start, end + 1));\n    previous = end + 1;\n  }\n\n  // shortcut if loop never entered:\n  // return the original string without creating new objects\n  if (previous === 0) return s;\n\n  // push the remaining characters\n  result = result + s.substring(previous);\n\n  return result;\n}\n\nfunction escapeXMLText(s) {\n  return s.replace(/[&<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXMLText(s) {\n  return s.replace(/&(amp|#38|lt|#60|gt|#62);/g, unescapeXMLReplace);\n}\n\nexports.escapeXML = escapeXML;\nexports.escapeXMLText = escapeXMLText;\nexports.unescapeXML = unescapeXML;\nexports.unescapeXMLText = unescapeXMLText;\n","'use strict';\n\nvar escape = require('./escape.js');\n\n/**\n * Element\n *\n * Attributes are in the element.attrs object. Children is a list of\n * either other Elements or Strings for text content.\n **/\nclass Element {\n  constructor(name, attrs) {\n    this.name = name;\n    this.parent = null;\n    this.children = [];\n    this.attrs = {};\n    this.setAttrs(attrs);\n  }\n\n  /* Accessors */\n\n  /**\n   * if (element.is('message', 'jabber:client')) ...\n   **/\n  is(name, xmlns) {\n    return this.getName() === name && (!xmlns || this.getNS() === xmlns);\n  }\n\n  /* without prefix */\n  getName() {\n    const idx = this.name.indexOf(\":\");\n    return idx >= 0 ? this.name.slice(idx + 1) : this.name;\n  }\n\n  /**\n   * retrieves the namespace of the current element, upwards recursively\n   **/\n  getNS() {\n    const idx = this.name.indexOf(\":\");\n    if (idx >= 0) {\n      const prefix = this.name.slice(0, idx);\n      return this.findNS(prefix);\n    }\n    return this.findNS();\n  }\n\n  /**\n   * find the namespace to the given prefix, upwards recursively\n   **/\n  findNS(prefix) {\n    if (!prefix) {\n      /* default namespace */\n      if (this.attrs.xmlns) {\n        return this.attrs.xmlns;\n      } else if (this.parent) {\n        return this.parent.findNS();\n      }\n    } else {\n      /* prefixed namespace */\n      const attr = \"xmlns:\" + prefix;\n      if (this.attrs[attr]) {\n        return this.attrs[attr];\n      } else if (this.parent) {\n        return this.parent.findNS(prefix);\n      }\n    }\n  }\n\n  /**\n   * Recursiverly gets all xmlns defined, in the form of {url:prefix}\n   **/\n  getXmlns() {\n    let namespaces = {};\n\n    if (this.parent) {\n      namespaces = this.parent.getXmlns();\n    }\n\n    for (const attr in this.attrs) {\n      const m = attr.match(\"xmlns:?(.*)\");\n      // eslint-disable-next-line  no-prototype-builtins\n      if (this.attrs.hasOwnProperty(attr) && m) {\n        namespaces[this.attrs[attr]] = m[1];\n      }\n    }\n    return namespaces;\n  }\n\n  setAttrs(attrs) {\n    if (typeof attrs === \"string\") {\n      this.attrs.xmlns = attrs;\n    } else if (attrs) {\n      Object.assign(this.attrs, attrs);\n    }\n  }\n\n  /**\n   * xmlns can be null, returns the matching attribute.\n   **/\n  getAttr(name, xmlns) {\n    if (!xmlns) {\n      return this.attrs[name];\n    }\n\n    const namespaces = this.getXmlns();\n\n    if (!namespaces[xmlns]) {\n      return null;\n    }\n\n    return this.attrs[[namespaces[xmlns], name].join(\":\")];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChild(name, xmlns) {\n    return this.getChildren(name, xmlns)[0];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChildren(name, xmlns) {\n    const result = [];\n    for (const child of this.children) {\n      if (\n        child.getName &&\n        child.getName() === name &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildByAttr(attr, val, xmlns, recursive) {\n    return this.getChildrenByAttr(attr, val, xmlns, recursive)[0];\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildrenByAttr(attr, val, xmlns, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (\n        child.attrs &&\n        child.attrs[attr] === val &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByAttr) {\n        result.push(child.getChildrenByAttr(attr, val, xmlns, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getChildrenByFilter(filter, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (filter(child)) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByFilter) {\n        result.push(child.getChildrenByFilter(filter, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getText() {\n    let text = \"\";\n    for (const child of this.children) {\n      if (typeof child === \"string\" || typeof child === \"number\") {\n        text += child;\n      }\n    }\n    return text;\n  }\n\n  getChildText(name, xmlns) {\n    const child = this.getChild(name, xmlns);\n    return child ? child.getText() : null;\n  }\n\n  /**\n   * Return all direct descendents that are Elements.\n   * This differs from `getChildren` in that it will exclude text nodes,\n   * processing instructions, etc.\n   */\n  getChildElements() {\n    return this.getChildrenByFilter((child) => {\n      return child instanceof Element;\n    });\n  }\n\n  /* Builder */\n\n  /** returns uppermost parent */\n  root() {\n    if (this.parent) {\n      return this.parent.root();\n    }\n    return this;\n  }\n\n  /** just parent or itself */\n  up() {\n    if (this.parent) {\n      return this.parent;\n    }\n    return this;\n  }\n\n  /** create child node and return it */\n  c(name, attrs) {\n    return this.cnode(new Element(name, attrs));\n  }\n\n  cnode(child) {\n    this.children.push(child);\n    if (typeof child === \"object\") {\n      child.parent = this;\n    }\n    return child;\n  }\n\n  append(...nodes) {\n    for (const node of nodes) {\n      this.children.push(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  prepend(...nodes) {\n    for (const node of nodes) {\n      this.children.unshift(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  /** add text node and return element */\n  t(text) {\n    this.children.push(text);\n    return this;\n  }\n\n  /* Manipulation */\n\n  /**\n   * Either:\n   *   el.remove(childEl)\n   *   el.remove('author', 'urn:...')\n   */\n  remove(el, xmlns) {\n    const filter =\n      typeof el === \"string\"\n        ? (child) => {\n            /* 1st parameter is tag name */\n            return !(child.is && child.is(el, xmlns));\n          }\n        : (child) => {\n            /* 1st parameter is element */\n            return child !== el;\n          };\n\n    this.children = this.children.filter(filter);\n\n    return this;\n  }\n\n  text(val) {\n    if (val && this.children.length === 1) {\n      this.children[0] = val;\n      return this;\n    }\n    return this.getText();\n  }\n\n  attr(attr, val) {\n    if (typeof val !== \"undefined\" || val === null) {\n      if (!this.attrs) {\n        this.attrs = {};\n      }\n      this.attrs[attr] = val;\n      return this;\n    }\n    return this.attrs[attr];\n  }\n\n  /* Serialization */\n\n  toString() {\n    let s = \"\";\n    this.write((c) => {\n      s += c;\n    });\n    return s;\n  }\n\n  _addChildren(writer) {\n    writer(\">\");\n    for (const child of this.children) {\n      /* Skip null/undefined */\n      if (child != null) {\n        if (child.write) {\n          child.write(writer);\n        } else if (typeof child === \"string\") {\n          writer(escape.escapeXMLText(child));\n        } else if (child.toString) {\n          writer(escape.escapeXMLText(child.toString(10)));\n        }\n      }\n    }\n    writer(\"</\");\n    writer(this.name);\n    writer(\">\");\n  }\n\n  write(writer) {\n    writer(\"<\");\n    writer(this.name);\n    for (const k in this.attrs) {\n      const v = this.attrs[k];\n      // === null || undefined\n      if (v != null) {\n        writer(\" \");\n        writer(k);\n        writer('=\"');\n        writer(escape.escapeXML(typeof v === \"string\" ? v : v.toString(10)));\n        writer('\"');\n      }\n    }\n    if (this.children.length === 0) {\n      writer(\"/>\");\n    } else {\n      this._addChildren(writer);\n    }\n  }\n}\n\nElement.prototype.tree = Element.prototype.root;\n\nmodule.exports = Element;\n","'use strict';\n\nvar Element = require('./Element.js');\n\nfunction append(el, child) {\n  if (Array.isArray(child)) {\n    for (const c of child) append(el, c);\n    return;\n  }\n\n  if (child === \"\" || child == null || child === true || child === false) {\n    return;\n  }\n\n  el.cnode(child);\n}\n\n/**\n * JSX compatible API, use this function as pragma\n * https://facebook.github.io/jsx/\n *\n * @param  {string} name  name of the element\n * @param  {object} attrs object of attribute key/value pairs\n * @return {Element}      Element\n */\nfunction createElement(name, attrs, ...children) {\n  if (typeof attrs === \"object\" && attrs !== null) {\n    // __self and __source are added by babel in development\n    // https://github.com/facebook/react/pull/4596\n    // https://babeljs.io/docs/en/babel-preset-react#development\n    // https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-source\n    delete attrs.__source;\n    delete attrs.__self;\n\n    for (const [key, value] of Object.entries(attrs)) {\n      if (value == null) delete attrs[key];\n      else attrs[key] = value.toString(10);\n    }\n  }\n\n  const el = new Element(name, attrs);\n\n  for (const child of children) {\n    append(el, child);\n  }\n\n  return el;\n}\n\nmodule.exports = createElement;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","'use strict';\n\nvar events = require('events');\nvar escape = require('../escape.js');\n\nconst STATE_TEXT = 0;\nconst STATE_IGNORE_COMMENT = 1;\nconst STATE_IGNORE_INSTRUCTION = 2;\nconst STATE_TAG_NAME = 3;\nconst STATE_TAG = 4;\nconst STATE_ATTR_NAME = 5;\nconst STATE_ATTR_EQ = 6;\nconst STATE_ATTR_QUOT = 7;\nconst STATE_ATTR_VALUE = 8;\nconst STATE_CDATA = 9;\nconst STATE_IGNORE_CDATA = 10;\n\nclass SaxLtx extends events.EventEmitter {\n  constructor() {\n    super();\n    let state = STATE_TEXT;\n    let remainder;\n    let parseRemainder;\n    let tagName;\n    let attrs;\n    let endTag;\n    let selfClosing;\n    let attrQuote;\n    let attrQuoteChar;\n    let recordStart = 0;\n    let attrName;\n\n    this._handleTagOpening = function _handleTagOpening(\n      endTag,\n      tagName,\n      attrs\n    ) {\n      if (!endTag) {\n        this.emit(\"startElement\", tagName, attrs);\n        if (selfClosing) {\n          this.emit(\"endElement\", tagName, true);\n        }\n      } else {\n        this.emit(\"endElement\", tagName, false);\n      }\n    };\n\n    this.write = function write(data) {\n      if (typeof data !== \"string\") {\n        data = data.toString();\n      }\n      let pos = 0;\n\n      /* Anything from previous write()? */\n      if (remainder) {\n        data = remainder + data;\n        pos += !parseRemainder ? remainder.length : 0;\n        parseRemainder = false;\n        remainder = null;\n      }\n\n      function endRecording() {\n        if (typeof recordStart === \"number\") {\n          const recorded = data.slice(recordStart, pos);\n          recordStart = undefined;\n          return recorded;\n        }\n      }\n\n      for (; pos < data.length; pos++) {\n        switch (state) {\n          case STATE_TEXT: {\n            // if we're looping through text, fast-forward using indexOf to\n            // the next '<' character\n            const lt = data.indexOf(\"<\", pos);\n            if (lt !== -1 && pos !== lt) {\n              pos = lt;\n            }\n\n            break;\n          }\n          case STATE_ATTR_VALUE: {\n            // if we're looping through an attribute, fast-forward using\n            // indexOf to the next end quote character\n            const quot = data.indexOf(attrQuoteChar, pos);\n            if (quot !== -1) {\n              pos = quot;\n            }\n\n            break;\n          }\n          case STATE_IGNORE_COMMENT: {\n            // if we're looping through a comment, fast-forward using\n            // indexOf to the first end-comment character\n            const endcomment = data.indexOf(\"-->\", pos);\n            if (endcomment !== -1) {\n              pos = endcomment + 2; // target the '>' character\n            }\n\n            break;\n          }\n          case STATE_IGNORE_CDATA: {\n            // if we're looping through a CDATA, fast-forward using\n            // indexOf to the first end-CDATA character ]]>\n            const endCDATA = data.indexOf(\"]]>\", pos);\n            if (endCDATA !== -1) {\n              pos = endCDATA + 2; // target the '>' character\n            }\n\n            break;\n          }\n          // No default\n        }\n\n        const c = data.charCodeAt(pos);\n        switch (state) {\n          case STATE_TEXT:\n            if (c === 60 /* < */) {\n              const text = endRecording();\n              if (text) {\n                this.emit(\"text\", escape.unescapeXML(text));\n              }\n              state = STATE_TAG_NAME;\n              recordStart = pos + 1;\n              attrs = {};\n            }\n            break;\n          case STATE_CDATA:\n            if (c === 93 /* ] */) {\n              if (data.substr(pos + 1, 2) === \"]>\") {\n                const cData = endRecording();\n                if (cData) {\n                  this.emit(\"text\", cData);\n                }\n                state = STATE_TEXT;\n              } else if (data.length < pos + 2) {\n                parseRemainder = true;\n                pos = data.length;\n              }\n            }\n            break;\n          case STATE_TAG_NAME:\n            if (c === 47 /* / */ && recordStart === pos) {\n              recordStart = pos + 1;\n              endTag = true;\n            } else if (c === 33 /* ! */) {\n              if (data.substr(pos + 1, 7) === \"[CDATA[\") {\n                recordStart = pos + 8;\n                state = STATE_CDATA;\n              } else if (\n                data.length < pos + 8 &&\n                \"[CDATA[\".startsWith(data.slice(pos + 1))\n              ) {\n                // We potentially have CDATA, but the chunk is ending; stop here and let the next write() decide\n                parseRemainder = true;\n                pos = data.length;\n              } else {\n                recordStart = undefined;\n                state = STATE_IGNORE_COMMENT;\n              }\n            } else if (c === 63 /* ? */) {\n              recordStart = undefined;\n              state = STATE_IGNORE_INSTRUCTION;\n            } else if (c <= 32 || c === 47 /* / */ || c === 62 /* > */) {\n              tagName = endRecording();\n              pos--;\n              state = STATE_TAG;\n            }\n            break;\n          case STATE_IGNORE_COMMENT:\n            if (c === 62 /* > */) {\n              const prevFirst = data.charCodeAt(pos - 1);\n              const prevSecond = data.charCodeAt(pos - 2);\n              if (\n                (prevFirst === 45 /* - */ && prevSecond === 45) /* - */ ||\n                (prevFirst === 93 /* ] */ && prevSecond === 93) /* ] */\n              ) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_IGNORE_INSTRUCTION:\n            if (c === 62 /* > */) {\n              const prev = data.charCodeAt(pos - 1);\n              if (prev === 63 /* ? */) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_TAG:\n            if (c === 62 /* > */) {\n              this._handleTagOpening(endTag, tagName, attrs);\n              tagName = undefined;\n              attrs = undefined;\n              endTag = undefined;\n              selfClosing = undefined;\n              state = STATE_TEXT;\n              recordStart = pos + 1;\n            } else if (c === 47 /* / */) {\n              selfClosing = true;\n            } else if (c > 32) {\n              recordStart = pos;\n              state = STATE_ATTR_NAME;\n            }\n            break;\n          case STATE_ATTR_NAME:\n            if (c <= 32 || c === 61 /* = */) {\n              attrName = endRecording();\n              pos--;\n              state = STATE_ATTR_EQ;\n            }\n            break;\n          case STATE_ATTR_EQ:\n            if (c === 61 /* = */) {\n              state = STATE_ATTR_QUOT;\n            }\n            break;\n          case STATE_ATTR_QUOT:\n            if (c === 34 /* \" */ || c === 39 /* ' */) {\n              attrQuote = c;\n              attrQuoteChar = c === 34 ? '\"' : \"'\";\n              state = STATE_ATTR_VALUE;\n              recordStart = pos + 1;\n            }\n            break;\n          case STATE_ATTR_VALUE:\n            if (c === attrQuote) {\n              const value = escape.unescapeXML(endRecording());\n              attrs[attrName] = value;\n              attrName = undefined;\n              state = STATE_TAG;\n            }\n            break;\n        }\n      }\n\n      if (typeof recordStart === \"number\" && recordStart <= data.length) {\n        remainder = data.slice(recordStart);\n        recordStart = 0;\n      }\n    };\n  }\n\n  end(data) {\n    if (data) {\n      this.write(data);\n    }\n\n    /* Uh, yeah */\n    this.write = function write() {};\n  }\n}\n\nmodule.exports = SaxLtx;\n","export default class TimeoutError extends Error {\n  constructor(message) {\n    super(message);\n    this.name = \"TimeoutError\";\n  }\n}\n","import TimeoutError from \"./TimeoutError.js\";\nimport delay from \"./delay.js\";\n\nexport default function timeout(promise, ms) {\n  const promiseDelay = delay(ms);\n\n  function cancelDelay() {\n    clearTimeout(promiseDelay.timeout);\n  }\n\n  const error = new TimeoutError();\n  return Promise.race([\n    promise.finally(cancelDelay),\n    promiseDelay.then(() => {\n      throw error;\n    }),\n  ]);\n}\n","export default function delay(ms) {\n  let timeout;\n  const promise = new Promise((resolve) => {\n    timeout = setTimeout(resolve, ms);\n  });\n  promise.timeout = timeout;\n  return promise;\n}\n","const map = new WeakMap();\n\nexport default function onoff(target) {\n  let m = map.get(target);\n\n  if (!m) {\n    const on = (target.addEventListener ?? target.addListener).bind(target);\n    const off = (target.removeEventListener ?? target.removeListener).bind(\n      target,\n    );\n    const once = (\n      target.once ??\n      ((event, handler) =>\n        target.addEventListener(event, handler, { once: true }))\n    ).bind(target);\n    m = { on, off, once };\n    map.set(target, m);\n  }\n\n  return m;\n}\n","import onoff from \"./onoff.js\";\nimport TimeoutError from \"./TimeoutError.js\";\n\nexport default function promise(target, event, rejectEvent = \"error\", timeout) {\n  return new Promise((resolve, reject) => {\n    let timeoutId;\n\n    const { off, once } = onoff(target);\n\n    const cleanup = () => {\n      clearTimeout(timeoutId);\n      off(event, onEvent);\n      off(rejectEvent, onError);\n    };\n\n    function onError(reason) {\n      reject(reason);\n      cleanup();\n    }\n\n    function onEvent(value) {\n      resolve(value);\n      cleanup();\n    }\n\n    once(event, onEvent);\n    if (rejectEvent) {\n      once(rejectEvent, onError);\n    }\n\n    if (timeout) {\n      const error = new TimeoutError();\n      timeoutId = setTimeout(() => {\n        cleanup();\n        reject(error);\n      }, timeout);\n    }\n  });\n}\n","export default function Deferred() {\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n}\n","export default function procedure(entity, stanza = null, handler) {\n  return new Promise((resolve, reject) => {\n    function onError(err) {\n      entity.removeListener(\"nonza\", listener);\n      reject(err);\n    }\n\n    function done(...args) {\n      entity.removeListener(\"nonza\", listener);\n      resolve(...args);\n    }\n\n    async function listener(element) {\n      try {\n        await handler(element, done);\n      } catch (err) {\n        onError(err);\n      }\n    }\n\n    stanza && entity.send(stanza).catch(onError);\n    entity.on(\"nonza\", listener);\n  });\n}\n","import onoff from \"./onoff.js\";\n\nexport default function listeners(events) {\n  return {\n    subscribe(target) {\n      const { on } = onoff(target);\n      for (const [event, handler] of Object.entries(events)) {\n        on(event, handler);\n      }\n    },\n    unsubscribe(target) {\n      const { off } = onoff(target);\n      for (const [event, handler] of Object.entries(events)) {\n        off(event, handler);\n      }\n    },\n  };\n}\n","export default class XMLError extends Error {\n  constructor(...args) {\n    super(...args);\n    this.name = \"XMLError\";\n  }\n}\n","import LtxParser from \"ltx/lib/parsers/ltx.js\";\nimport Element from \"ltx/lib/Element.js\";\nimport { EventEmitter } from \"@xmpp/events\";\n\nimport XMLError from \"./XMLError.js\";\n\nclass Parser extends EventEmitter {\n  constructor() {\n    super();\n    const parser = new LtxParser();\n    this.root = null;\n    this.cursor = null;\n\n    parser.on(\"startElement\", this.onStartElement.bind(this));\n    parser.on(\"endElement\", this.onEndElement.bind(this));\n    parser.on(\"text\", this.onText.bind(this));\n\n    this.parser = parser;\n  }\n\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { root, cursor } = this;\n\n    if (!root) {\n      this.root = element;\n      this.emit(\"start\", element);\n    } else if (cursor !== root) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { root, cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor === root) {\n      this.emit(\"end\", root);\n      return;\n    }\n\n    if (!cursor.parent) {\n      cursor.parent = root;\n      this.emit(\"element\", cursor);\n      this.cursor = root;\n      return;\n    }\n\n    this.cursor = cursor.parent;\n  }\n\n  onText(str) {\n    const { cursor } = this;\n    if (!cursor) {\n      this.emit(\"error\", new XMLError(`${str} must be a child.`));\n      return;\n    }\n\n    cursor.t(str);\n  }\n\n  write(data) {\n    this.parser.write(data);\n  }\n\n  end(data) {\n    if (data) {\n      this.parser.write(data);\n    }\n  }\n}\n\nParser.XMLError = XMLError;\n\nexport default Parser;\n","import Element from \"ltx/lib/Element.js\";\nimport createElement from \"ltx/lib/createElement.js\";\nimport {\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n} from \"ltx/lib/escape.js\";\n\nimport Parser from \"./lib/Parser.js\";\nimport XMLError from \"./lib/XMLError.js\";\n\nexport default function xml(...args) {\n  return createElement(...args);\n}\n\nObject.assign(xml, {\n  Element,\n  createElement,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n  xml,\n});\n\nexport {\n  Element,\n  createElement,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n  xml,\n};\n","export function detect(local) {\n  if (!local) {\n    return false;\n  }\n\n  // Remove all escaped sequences\n  const tmp = local\n    .replaceAll(String.raw`\\20`, \"\")\n    .replaceAll(String.raw`\\22`, \"\")\n    .replaceAll(String.raw`\\26`, \"\")\n    .replaceAll(String.raw`\\27`, \"\")\n    .replaceAll(String.raw`\\2f`, \"\")\n    .replaceAll(String.raw`\\3a`, \"\")\n    .replaceAll(String.raw`\\3c`, \"\")\n    .replaceAll(String.raw`\\3e`, \"\")\n    .replaceAll(String.raw`\\40`, \"\")\n    .replaceAll(String.raw`\\5c`, \"\");\n\n  // Detect if we have unescaped sequences\n  const search = tmp.search(/[ \"&'/:<>@\\\\]/g);\n  if (search === -1) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Escape the local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return An escaped local part\n */\nexport function escape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replaceAll(/^\\s+|\\s+$/g, \"\")\n    .replaceAll(\"\\\\\", String.raw`\\5c`)\n    .replaceAll(\" \", String.raw`\\20`)\n    .replaceAll('\"', String.raw`\\22`)\n    .replaceAll(\"&\", String.raw`\\26`)\n    .replaceAll(\"'\", String.raw`\\27`)\n    .replaceAll(\"/\", String.raw`\\2f`)\n    .replaceAll(\":\", String.raw`\\3a`)\n    .replaceAll(\"<\", String.raw`\\3c`)\n    .replaceAll(\">\", String.raw`\\3e`)\n    .replaceAll(\"@\", String.raw`\\40`);\n}\n\n/**\n * Unescape a local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return unescaped local part\n */\nexport function unescape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replaceAll(String.raw`\\20`, \" \")\n    .replaceAll(String.raw`\\22`, '\"')\n    .replaceAll(String.raw`\\26`, \"&\")\n    .replaceAll(String.raw`\\27`, \"'\")\n    .replaceAll(String.raw`\\2f`, \"/\")\n    .replaceAll(String.raw`\\3a`, \":\")\n    .replaceAll(String.raw`\\3c`, \"<\")\n    .replaceAll(String.raw`\\3e`, \">\")\n    .replaceAll(String.raw`\\40`, \"@\")\n    .replaceAll(String.raw`\\5c`, \"\\\\\");\n}\n","import * as escaping from \"./escaping.js\";\n\n/**\n * JID implements\n * - XMPP addresses according to RFC6122\n * - XEP-0106: JID Escaping\n *\n * @see http://tools.ietf.org/html/rfc6122#section-2\n * @see http://xmpp.org/extensions/xep-0106.html\n */\nclass JID {\n  constructor(local, domain, resource) {\n    if (typeof domain !== \"string\" || !domain) {\n      throw new TypeError(`Invalid domain.`);\n    }\n\n    this.setDomain(domain);\n    this.setLocal(typeof local === \"string\" ? local : \"\");\n    this.setResource(typeof resource === \"string\" ? resource : \"\");\n  }\n\n  [Symbol.toPrimitive](hint) {\n    if (hint === \"number\") {\n      return Number.NaN;\n    }\n\n    return this.toString();\n  }\n\n  toString(unescape) {\n    let s = this._domain;\n    if (this._local) {\n      s = this.getLocal(unescape) + \"@\" + s;\n    }\n\n    if (this._resource) {\n      s = s + \"/\" + this._resource;\n    }\n\n    return s;\n  }\n\n  /**\n   * Convenience method to distinguish users\n   * */\n  bare() {\n    if (this._resource) {\n      return new JID(this._local, this._domain, null);\n    }\n\n    return this;\n  }\n\n  /**\n   * Comparison function\n   * */\n  equals(other) {\n    return (\n      this._local === other._local &&\n      this._domain === other._domain &&\n      this._resource === other._resource\n    );\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-localpart\n   * */\n  setLocal(local, escape) {\n    escape = escape || escaping.detect(local);\n\n    if (escape) {\n      local = escaping.escape(local);\n    }\n\n    this._local = local && local.toLowerCase();\n    return this;\n  }\n\n  getLocal(unescape = false) {\n    let local = null;\n\n    local = unescape ? escaping.unescape(this._local) : this._local;\n\n    return local;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-domain\n   */\n  setDomain(domain) {\n    this._domain = domain.toLowerCase();\n    return this;\n  }\n\n  getDomain() {\n    return this._domain;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-resourcepart\n   */\n  setResource(resource) {\n    this._resource = resource;\n    return this;\n  }\n\n  getResource() {\n    return this._resource;\n  }\n}\n\nObject.defineProperty(JID.prototype, \"local\", {\n  get: JID.prototype.getLocal,\n  set: JID.prototype.setLocal,\n});\n\nObject.defineProperty(JID.prototype, \"domain\", {\n  get: JID.prototype.getDomain,\n  set: JID.prototype.setDomain,\n});\n\nObject.defineProperty(JID.prototype, \"resource\", {\n  get: JID.prototype.getResource,\n  set: JID.prototype.setResource,\n});\n\nexport default JID;\n","import JID from \"./JID.js\";\n\nexport default function parse(s) {\n  let local;\n  let resource;\n\n  const resourceStart = s.indexOf(\"/\");\n  if (resourceStart !== -1) {\n    resource = s.slice(resourceStart + 1);\n    s = s.slice(0, resourceStart);\n  }\n\n  const atStart = s.indexOf(\"@\");\n  if (atStart !== -1) {\n    local = s.slice(0, atStart);\n    s = s.slice(atStart + 1);\n  }\n\n  return new JID(local, s, resource);\n}\n","import JID from \"./lib/JID.js\";\nimport { detect, escape, unescape } from \"./lib/escaping.js\";\nimport parse from \"./lib/parse.js\";\n\nexport function equal(a, b) {\n  return a.equals(b);\n}\n\nfunction jid(...args) {\n  if (!args[1] && !args[2]) {\n    return parse(...args);\n  }\n\n  return new JID(...args);\n}\n\nconst j = jid.bind();\nj.jid = jid;\nj.JID = JID;\nj.parse = parse;\nj.equal = equal;\nj.detectEscape = detect;\nj.escapeLocal = escape;\nj.unescapeLocal = unescape;\n\nexport default j;\n\nexport { jid, JID, parse };\n\nexport {\n  detect as detectEscape,\n  escape as escapeLocal,\n  unescape as unescapeLocal,\n};\n","// https://xmpp.org/rfcs/rfc6120.html#rfc.section.4.9.2\n\nclass XMPPError extends Error {\n  constructor(condition, text, application) {\n    super(condition + (text ? ` - ${text}` : \"\"));\n    this.name = \"XMPPError\";\n    this.condition = condition;\n    this.text = text;\n    this.application = application;\n  }\n\n  static fromElement(element) {\n    const [condition, second, third] = element.getChildElements();\n    let text;\n    let application;\n\n    if (second) {\n      if (second.is(\"text\")) {\n        text = second;\n      } else if (second) {\n        application = second;\n      }\n\n      if (third) application = third;\n    }\n\n    const error = new this(\n      condition.name,\n      text ? text.text() : \"\",\n      application,\n    );\n    error.element = element;\n    return error;\n  }\n}\n\nexport default XMPPError;\n","import XMPPError from \"@xmpp/error\";\n\n// https://xmpp.org/rfcs/rfc6120.html#streams-error\n\nclass StreamError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"StreamError\";\n  }\n}\n\nexport default StreamError;\n","function parseURI(URI) {\n  let { port, hostname, protocol } = new URL(URI);\n  // https://github.com/nodejs/node/issues/12410#issuecomment-294138912\n  if (hostname === \"[::1]\") {\n    hostname = \"::1\";\n  }\n\n  return { port, hostname, protocol };\n}\n\nfunction parseHost(host) {\n  const { port, hostname } = parseURI(`http://${host}`);\n  return { port, hostname };\n}\n\nfunction parseService(service) {\n  return service.includes(\"://\") ? parseURI(service) : parseHost(service);\n}\n\nexport { parseURI, parseHost, parseService };\n","import { EventEmitter, promise, listeners } from \"@xmpp/events\";\nimport jid from \"@xmpp/jid\";\nimport xml from \"@xmpp/xml\";\n\nimport StreamError from \"./lib/StreamError.js\";\nimport { parseHost, parseService } from \"./lib/util.js\";\n\nconst NS_STREAM = \"urn:ietf:params:xml:ns:xmpp-streams\";\nconst NS_JABBER_STREAM = \"http://etherx.jabber.org/streams\";\n\nclass Connection extends EventEmitter {\n  #socketListeners = null;\n  #parserListeners = null;\n\n  constructor(options = {}) {\n    super();\n\n    if (typeof options === \"string\") {\n      options = { domain: options };\n    }\n\n    this.jid = null;\n    this.timeout = options.timeout || 2000;\n    this.options = options;\n    this.status = \"offline\";\n    this.socket = null;\n    this.parser = null;\n    this.root = null;\n  }\n\n  isSecure() {\n    return this.socket?.secure === true;\n  }\n\n  async _streamError(condition, children) {\n    try {\n      await this.send(\n        // prettier-ignore\n        xml('stream:error', {}, [\n          xml(condition, {xmlns: NS_STREAM}, children),\n        ]),\n      );\n    } catch {}\n\n    return this.disconnect();\n  }\n\n  _onData(data) {\n    const str = data.toString(\"utf8\");\n    this.parser.write(str);\n  }\n\n  #onParserError(error) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-bad-format\n    // \"This error can be used instead of the more specific XML-related errors,\n    // such as <bad-namespace-prefix/>, <invalid-xml/>, <not-well-formed/>, <restricted-xml/>,\n    // and <unsupported-encoding/>. However, the more specific errors are RECOMMENDED.\"\n    this._streamError(\"bad-format\");\n    this._detachParser();\n    this.emit(\"error\", error);\n  }\n\n  #onSocketClosed(dirty, reason) {\n    this._detachSocket();\n    this._status(\"disconnect\", { clean: !dirty, reason });\n  }\n\n  #onStreamClosed(dirty, reason) {\n    this._detachParser();\n    this._status(\"close\", { clean: !dirty, reason });\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    this.#socketListeners ??= listeners({\n      data: this._onData.bind(this),\n      close: this.#onSocketClosed.bind(this),\n      connect: () => this._status(\"connect\"),\n      error: (error) => this.emit(\"error\", error),\n    });\n    this.#socketListeners.subscribe(this.socket);\n  }\n\n  _detachSocket() {\n    this.socket && this.#socketListeners?.unsubscribe(this.socket);\n    this.socket = null;\n  }\n\n  _onElement(element) {\n    const isStreamError = element.is(\"error\", NS_JABBER_STREAM);\n\n    if (isStreamError) {\n      this._onStreamError(element);\n    }\n\n    this.emit(\"element\", element);\n    this.emit(this.isStanza(element) ? \"stanza\" : \"nonza\", element);\n\n    if (isStreamError) {\n      // \"Stream Errors Are Unrecoverable\"\n      // \"The entity that receives the stream error then SHALL close the stream\"\n      this.disconnect();\n    }\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error\n  _onStreamError(element) {\n    const error = StreamError.fromElement(element);\n\n    if (error.condition === \"see-other-host\") {\n      return this._onSeeOtherHost(error);\n    }\n\n    this.emit(\"error\", error);\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-see-other-host\n  async _onSeeOtherHost(error) {\n    const { protocol } = parseService(this.options.service);\n\n    const host = error.element.getChildText(\"see-other-host\");\n    const { port } = parseHost(host);\n\n    let service;\n    service = port\n      ? `${protocol || \"xmpp:\"}//${host}`\n      : (protocol ? `${protocol}//` : \"\") + host;\n\n    try {\n      await promise(this, \"disconnect\");\n      const { domain, lang } = this.options;\n      await this.connect(service);\n      await this.open({ domain, lang });\n    } catch (err) {\n      this.emit(\"error\", err);\n    }\n  }\n\n  _attachParser(parser) {\n    this.parser = parser;\n    this.#parserListeners ??= listeners({\n      element: this._onElement.bind(this),\n      error: this.#onParserError.bind(this),\n      end: this.#onStreamClosed.bind(this),\n      start: (element) => this._status(\"open\", element),\n    });\n    this.#parserListeners.subscribe(this.parser);\n  }\n\n  _detachParser() {\n    this.parser && this.#parserListeners?.unsubscribe(this.parser);\n    this.parser = null;\n    this.root = null;\n  }\n\n  _jid(id) {\n    this.jid = jid(id);\n    return this.jid;\n  }\n\n  /*\n  [\n    \"offline\",\n    // \"disconnect\",\n    \"connecting\",\n    \"connected\",\n    \"opening\",\n    \"open\",\n    \"online\",\n    \"closing\",\n    \"close\",\n    \"disconnecting\",\n    \"disconnect\",\n    \"offline\",\n  ];\n  */\n  _status(status, ...args) {\n    if (this.status === status) return;\n    this.status = status;\n    this.emit(\"status\", status, ...args);\n    this.emit(status, ...args);\n  }\n\n  _ready(resumed = false) {\n    if (resumed) {\n      this.status = \"online\";\n    } else {\n      this._status(\"online\", this.jid);\n    }\n  }\n\n  async disconnect() {\n    let el;\n\n    try {\n      el = await this._closeStream();\n    } catch (err) {\n      this.#onStreamClosed(err);\n    }\n\n    try {\n      await this._closeSocket();\n    } catch (err) {\n      this.#onSocketClosed(true, err);\n    }\n\n    return el;\n  }\n\n  /**\n   * Opens the socket then opens the stream\n   */\n  async start() {\n    if (this.status !== \"offline\") {\n      throw new Error(\"Connection is not offline\");\n    }\n\n    const { service, domain, lang } = this.options;\n\n    await this.connect(service);\n\n    const promiseOnline = promise(this, \"online\");\n\n    await this.open({ domain, lang });\n\n    return promiseOnline;\n  }\n\n  /**\n   * Connects the socket\n   */\n  async connect(service) {\n    this._status(\"connecting\", service);\n    const socket = new this.Socket();\n    this._attachSocket(socket);\n    // The 'connect' status is set by the socket 'connect' listener\n    socket.connect(this.socketParameters(service));\n    return promise(socket, \"connect\");\n  }\n\n  /**\n   * Disconnects the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async _closeSocket(timeout = this.timeout) {\n    this._status(\"disconnecting\");\n    this.socket.end();\n\n    // The 'disconnect' status is set by the socket 'close' listener\n    await promise(this.socket, \"close\", \"error\", timeout);\n  }\n\n  /**\n   * Opens the stream\n   */\n  async open(options) {\n    this._status(\"opening\");\n\n    const { domain, lang } = options;\n\n    const headerElement = this.headerElement();\n    headerElement.attrs.to = domain;\n    headerElement.attrs[\"xml:lang\"] = lang;\n    this.root = headerElement;\n\n    this._attachParser(new this.Parser());\n\n    await this.write(this.header(headerElement));\n    return promise(this, \"open\", \"error\", this.timeout);\n  }\n\n  /**\n   * Closes the stream then closes the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async stop() {\n    const el = await this.disconnect();\n    this._status(\"offline\", el);\n    return el;\n  }\n\n  /**\n   * Closes the stream and wait for the server to close it\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async _closeStream(timeout = this.timeout) {\n    await this.#runHooks(\"close\");\n\n    const fragment = this.footer(this.footerElement());\n\n    await this.write(fragment);\n    this._status(\"closing\");\n    return promise(this.parser, \"end\", \"error\", timeout);\n    // The 'close' status is set by the parser 'end' listener\n  }\n\n  /**\n   * Restart the stream\n   * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation-restart\n   */\n  async restart() {\n    this._detachParser();\n    const { domain, lang } = this.options;\n    return this.open({ domain, lang });\n  }\n\n  async send(element) {\n    element.parent = this.root;\n    await this.write(element.toString());\n    this.emit(\"send\", element);\n  }\n\n  sendReceive(element, timeout = this.timeout) {\n    return Promise.all([\n      this.send(element),\n      promise(this, \"element\", \"error\", timeout),\n    ]).then(([, el]) => el);\n  }\n\n  async write(string) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-close\n    // \"Refrain from sending any further data over its outbound stream to the other entity\"\n    if (this.status === \"closing\") {\n      throw new Error(\"Connection is closing\");\n    }\n\n    return new Promise((resolve, reject) => {\n      this.socket.write(string, (err) => (err ? reject(err) : resolve()));\n    });\n  }\n\n  isStanza(element) {\n    const { name } = element;\n    return name === \"iq\" || name === \"message\" || name === \"presence\";\n  }\n\n  isNonza(element) {\n    return !this.isStanza(element);\n  }\n\n  // Override\n  header(el) {\n    return el.toString();\n  }\n\n  // Override\n  headerElement() {\n    return new xml.Element(\"\", {\n      version: \"1.0\",\n      xmlns: this.NS,\n    });\n  }\n\n  // Override\n  footer(el) {\n    return el.toString();\n  }\n\n  // Override\n  footerElement() {}\n\n  // Override\n  socketParameters() {}\n\n  /* Experimental hooks */\n  #hooks = new Map();\n  #hook_events = new Set([\"close\"]);\n  hook(event, handler /*priority = 0 TODO */) {\n    this.#assertHookEventName(event);\n\n    if (!this.#hooks.has(event)) {\n      this.#hooks.set(event, new Set());\n    }\n\n    this.#hooks.get(event).add([handler]);\n  }\n  #assertHookEventName(event) {\n    if (!this.#hook_events.has(event)) {\n      throw new Error(`Hook event name \"${event}\" is unknown.`);\n    }\n  }\n  unhook(event, handler) {\n    this.#assertHookEventName(event);\n    const handlers = this.#hooks.get(\"event\");\n    const item = [...handlers].find((item) => item.handler === handler);\n    handlers.remove(item);\n  }\n  async #runHooks(event, ...args) {\n    this.#assertHookEventName(event);\n\n    const hooks = this.#hooks.get(event);\n    if (!hooks) return;\n\n    // TODO run hooks by priority\n    // run hooks with the same priority in parallel\n\n    await Promise.all(\n      [...hooks].map(async ([handler]) => {\n        try {\n          await handler(...args);\n        } catch (err) {\n          this.emit(\"error\", err);\n        }\n      }),\n    );\n  }\n}\n\n// Override\nConnection.prototype.NS = \"\";\nConnection.prototype.Socket = null;\nConnection.prototype.Parser = null;\n\nexport default Connection;\n","import Connection from \"@xmpp/connection\";\n\nclass Client extends Connection {\n  constructor(options) {\n    super(options);\n    this.transports = [];\n  }\n\n  send(element, ...args) {\n    return this.Transport.prototype.send.call(this, element, ...args);\n  }\n\n  sendMany(...args) {\n    return this.Transport.prototype.sendMany.call(this, ...args);\n  }\n\n  _findTransport(service) {\n    return this.transports.find((Transport) => {\n      try {\n        return Transport.prototype.socketParameters(service) !== undefined;\n      } catch {\n        return false;\n      }\n    });\n  }\n\n  connect(service) {\n    const Transport = this._findTransport(service);\n\n    if (!Transport) {\n      throw new Error(\"No compatible connection method found.\");\n    }\n\n    this.Transport = Transport;\n    this.Socket = Transport.prototype.Socket;\n    this.Parser = Transport.prototype.Parser;\n\n    return super.connect(service);\n  }\n\n  socketParameters(...args) {\n    return this.Transport.prototype.socketParameters(...args);\n  }\n\n  header(headerElement, ...args) {\n    // if the client knows the XMPP identity then it SHOULD include the 'from' attribute\n    // after the confidentiality and integrity of the stream are protected via TLS\n    // or an equivalent security layer.\n    // https://xmpp.org/rfcs/rfc6120.html#rfc.section.4.7.1\n    const from = this.isSecure() && this.jid?.bare().toString();\n    if (from) headerElement.attrs.from = from;\n    return this.Transport.prototype.header(headerElement, ...args);\n  }\n\n  headerElement(...args) {\n    return this.Transport.prototype.headerElement(...args);\n  }\n\n  footer(...args) {\n    return this.Transport.prototype.footer(...args);\n  }\n\n  footerElement(...args) {\n    return this.Transport.prototype.footerElement(...args);\n  }\n}\n\nClient.prototype.NS = \"jabber:client\";\n\nexport default Client;\n","import { EventEmitter } from \"@xmpp/events\";\n\nclass Reconnect extends EventEmitter {\n  constructor(entity) {\n    super();\n\n    this.delay = 1000;\n    this.entity = entity;\n    this._timeout = null;\n  }\n\n  #onDisconnect = () => {\n    this.scheduleReconnect();\n  };\n\n  scheduleReconnect() {\n    const { entity, delay, _timeout } = this;\n    clearTimeout(_timeout);\n    this._timeout = setTimeout(async () => {\n      if (entity.status !== \"disconnect\") {\n        return;\n      }\n\n      try {\n        await this.reconnect();\n      } catch {\n        // Ignoring the rejection is safe because the error is emitted on entity by #start\n      }\n    }, delay);\n  }\n\n  async reconnect() {\n    const { entity } = this;\n    this.emit(\"reconnecting\");\n\n    const { service, domain, lang } = entity.options;\n    await entity.connect(service);\n    await entity.open({ domain, lang });\n\n    this.emit(\"reconnected\");\n  }\n\n  start() {\n    const { entity } = this;\n    entity.on(\"disconnect\", this.#onDisconnect);\n  }\n\n  stop() {\n    const { entity, _timeout } = this;\n    entity.removeListener(\"disconnect\", this.#onDisconnect);\n    clearTimeout(_timeout);\n  }\n}\n\nexport default function reconnect({ entity }) {\n  const r = new Reconnect(entity);\n  r.start();\n  return r;\n}\n","import { EventEmitter, listeners } from \"@xmpp/events\";\nimport { parseURI } from \"@xmpp/connection/lib/util.js\";\n\nconst CODE = \"ECONNERROR\";\n\nexport function isSecure(url) {\n  const uri = parseURI(url);\n  if (uri.protocol === \"wss:\") return true;\n  if ([\"localhost\", \"127.0.0.1\", \"::1\"].includes(uri.hostname)) return true;\n  return false;\n}\n\nexport default class Socket extends EventEmitter {\n  #listeners = null;\n  socket = null;\n  url = null;\n  secure = false;\n\n  connect(url) {\n    this.url = url;\n    this.secure = isSecure(url);\n    // eslint-disable-next-line n/no-unsupported-features/node-builtins\n    this._attachSocket(new WebSocket(url, [\"xmpp\"]));\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    this.#listeners ??= listeners({\n      open: () => this.emit(\"connect\"),\n      message: ({ data }) => this.emit(\"data\", data),\n      error: (event) => {\n        const { url } = this;\n        // WS\n        let { error } = event;\n        // DOM\n        if (!error) {\n          error = new Error(event.message || `WebSocket ${CODE} ${url}`);\n          error.errno = CODE;\n          error.code = CODE;\n        }\n\n        error.event = event;\n        error.url = url;\n        this.emit(\"error\", error);\n      },\n      close: (event) => {\n        this._detachSocket();\n        this.emit(\"close\", !event.wasClean, event);\n      },\n    });\n    this.#listeners.subscribe(this.socket);\n  }\n\n  _detachSocket() {\n    this.url = null;\n    this.secure = false;\n    this.socket && this.#listeners?.unsubscribe(this.socket);\n    this.socket = null;\n  }\n\n  end() {\n    this.socket.close();\n  }\n\n  write(data, fn) {\n    function done(err) {\n      if (!fn) return;\n      // eslint-disable-next-line promise/catch-or-return, promise/no-promise-in-callback\n      Promise.resolve().then(() => fn(err));\n    }\n\n    try {\n      this.socket.send(data);\n    } catch (err) {\n      done(err);\n      return;\n    }\n    done();\n  }\n}\n","import Connection from \"@xmpp/connection\";\nimport xml from \"@xmpp/xml\";\n\nimport Socket from \"./Socket.js\";\nimport FramedParser from \"./FramedParser.js\";\n\nconst NS_FRAMING = \"urn:ietf:params:xml:ns:xmpp-framing\";\n\n/* References\n * WebSocket protocol https://tools.ietf.org/html/rfc6455\n * WebSocket Web API https://html.spec.whatwg.org/multipage/comms.html#network\n * XMPP over WebSocket https://tools.ietf.org/html/rfc7395\n */\n\nclass ConnectionWebSocket extends Connection {\n  send(element, ...args) {\n    element.attrs.xmlns ??= this.NS;\n    return super.send(element, ...args);\n  }\n\n  async sendMany(elements) {\n    for (const element of elements) {\n      element.attrs.xmlns ??= this.NS;\n      element.parent = this.root;\n      this.socket.write(element.toString());\n      this.emit(\"send\", element);\n    }\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.6\n  footerElement() {\n    return new xml.Element(\"close\", {\n      xmlns: NS_FRAMING,\n    });\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.4\n  headerElement() {\n    const el = super.headerElement();\n    el.name = \"open\";\n    el.attrs.xmlns = NS_FRAMING;\n    return el;\n  }\n\n  socketParameters(service) {\n    return /^wss?:\\/\\//.test(service) ? service : undefined;\n  }\n}\n\nConnectionWebSocket.prototype.Socket = Socket;\nConnectionWebSocket.prototype.NS = \"jabber:client\";\nConnectionWebSocket.prototype.Parser = FramedParser;\n\nexport default ConnectionWebSocket;\n","import { Parser, Element, XMLError } from \"@xmpp/xml\";\n\nexport default class FramedParser extends Parser {\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { cursor } = this;\n\n    if (cursor) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor.parent) {\n      this.cursor = cursor.parent;\n      return;\n    }\n\n    if (cursor.is(\"open\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"start\", cursor);\n    } else if (cursor.is(\"close\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"end\", cursor);\n    } else {\n      this.emit(\"element\", cursor);\n    }\n\n    this.cursor = null;\n  }\n}\n","'use strict'\n\n/**\n * Expose compositor.\n */\n\nmodule.exports = compose\n\n/**\n * Compose `middleware` returning\n * a fully valid middleware comprised\n * of all those which are passed.\n *\n * @param {Array} middleware\n * @return {Function}\n * @api public\n */\n\nfunction compose (middleware) {\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!')\n  for (const fn of middleware) {\n    if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!')\n  }\n\n  /**\n   * @param {Object} context\n   * @return {Promise}\n   * @api public\n   */\n\n  return function (context, next) {\n    // last called middleware #\n    let index = -1\n    return dispatch(0)\n    function dispatch (i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = middleware[i]\n      if (i === middleware.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, dispatch.bind(null, i + 1)));\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}\n","export default class Context {\n  constructor(entity, stanza) {\n    this.stanza = stanza;\n    this.entity = entity;\n\n    const { name, attrs } = stanza;\n    const { type, id } = attrs;\n\n    this.name = name;\n    this.id = id || \"\";\n\n    if (name === \"message\") {\n      this.type = type || \"normal\";\n    } else if (name === \"presence\") {\n      this.type = type || \"available\";\n    } else {\n      this.type = type || \"\";\n    }\n\n    this.from = null;\n    this.to = null;\n    this.local = \"\";\n    this.domain = \"\";\n    this.resource = \"\";\n  }\n}\n","import JID from \"@xmpp/jid\";\n\nimport Context from \"./Context.js\";\n\nexport default class IncomingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid } = entity;\n    const { domain } = entity.options ?? {};\n\n    const to = stanza.attrs.to || jid?.toString();\n    const from = stanza.attrs.from || domain;\n\n    if (to) this.to = new JID(to);\n\n    if (from) {\n      this.from = new JID(from);\n      this.local = this.from.local;\n      this.domain = this.from.domain;\n      this.resource = this.from.resource;\n    }\n  }\n}\n","import JID from \"@xmpp/jid\";\n\nimport Context from \"./Context.js\";\n\nexport default class OutgoingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid } = entity;\n    const { domain } = entity.options ?? {};\n\n    const from = stanza.attrs.from || jid?.toString();\n    const to = stanza.attrs.to || domain;\n\n    if (from) this.from = new JID(from);\n\n    if (to) {\n      this.to = new JID(to);\n      this.local = this.to.local;\n      this.domain = this.to.domain;\n      this.resource = this.to.resource;\n    }\n  }\n}\n","import compose from \"koa-compose\";\n\nimport IncomingContext from \"./lib/IncomingContext.js\";\nimport OutgoingContext from \"./lib/OutgoingContext.js\";\n\nfunction listener(entity, middleware, Context) {\n  return (stanza) => {\n    const ctx = new Context(entity, stanza);\n    return compose(middleware)(ctx);\n  };\n}\n\nfunction errorHandler(entity) {\n  return (ctx, next) => {\n    next()\n      .then((reply) => reply && entity.send(reply))\n      .catch((err) => entity.emit(\"error\", err));\n  };\n}\n\nexport default function middleware({ entity }) {\n  const incoming = [errorHandler(entity)];\n  const outgoing = [];\n\n  const incomingListener = listener(entity, incoming, IncomingContext);\n  const outgoingListener = listener(entity, outgoing, OutgoingContext);\n\n  entity.on(\"element\", incomingListener);\n  entity.on(\"send\", outgoingListener);\n\n  return {\n    use(fn) {\n      incoming.push(fn);\n      return fn;\n    },\n    filter(fn) {\n      outgoing.push(fn);\n      return fn;\n    },\n  };\n}\n","import XMPPError from \"@xmpp/error\";\n\n/* https://xmpp.org/rfcs/rfc6120.html#stanzas-error */\n\nclass StanzaError extends XMPPError {\n  constructor(condition, text, application, type) {\n    super(condition, text, application);\n    this.type = type;\n    this.name = \"StanzaError\";\n  }\n\n  static fromElement(element) {\n    const error = super.fromElement(element);\n    error.type = element.attrs.type;\n    return error;\n  }\n}\n\nexport default StanzaError;\n","import xid from \"@xmpp/id\";\nimport StanzaError from \"@xmpp/middleware/lib/StanzaError.js\";\nimport { Deferred, timeout as timeoutPromise } from \"@xmpp/events\";\nimport xml from \"@xmpp/xml\";\n\nfunction isReply({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type !== \"error\" && type !== \"result\") return false;\n  return true;\n}\n\nclass IQCaller {\n  constructor({ entity, middleware }) {\n    this.handlers = new Map();\n    this.entity = entity;\n    this.middleware = middleware;\n  }\n\n  start() {\n    this.middleware.use(this._route.bind(this));\n  }\n\n  _route({ type, name, id, stanza }, next) {\n    if (!isReply({ name, type })) return next();\n\n    const deferred = this.handlers.get(id);\n\n    if (!deferred) {\n      return next();\n    }\n\n    if (type === \"error\") {\n      deferred.reject(StanzaError.fromElement(stanza.getChild(\"error\")));\n    } else {\n      deferred.resolve(stanza);\n    }\n\n    this.handlers.delete(id);\n  }\n\n  async request(stanza, timeout = 30 * 1000) {\n    if (!stanza.attrs.id) {\n      stanza.attrs.id = xid();\n    }\n\n    const deferred = new Deferred();\n    this.handlers.set(stanza.attrs.id, deferred);\n\n    try {\n      await this.entity.send(stanza);\n      await timeoutPromise(deferred.promise, timeout);\n    } catch (err) {\n      this.handlers.delete(stanza.attrs.id);\n      throw err;\n    }\n\n    return deferred.promise;\n  }\n\n  _childRequest(type, element, to, ...args) {\n    const {\n      name,\n      attrs: { xmlns },\n    } = element;\n    return this.request(xml(\"iq\", { type, to }, element), ...args).then(\n      (stanza) => stanza.getChild(name, xmlns),\n    );\n  }\n\n  async get(...args) {\n    return this._childRequest(\"get\", ...args);\n  }\n\n  async set(...args) {\n    return this._childRequest(\"set\", ...args);\n  }\n}\n\nexport default function iqCaller(...args) {\n  const iqCaller = new IQCaller(...args);\n  iqCaller.start();\n  return iqCaller;\n}\n","export default function id() {\n  let i;\n  while (!i) {\n    i = Math.random().toString(36).slice(2, 12);\n  }\n\n  return i;\n}\n","import xml from \"@xmpp/xml\";\n\n/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-semantics-iq\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-error\n */\n\nconst NS_STANZA = \"urn:ietf:params:xml:ns:xmpp-stanzas\";\n\nfunction isQuery({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type === \"error\" || type === \"result\") return false;\n  return true;\n}\n\nfunction isValidQuery({ type }, children, child) {\n  if (type !== \"get\" && type !== \"set\") return false;\n  if (children.length !== 1) return false;\n  if (!child) return false;\n  return true;\n}\n\nfunction buildReply({ stanza }) {\n  return xml(\"iq\", {\n    to: stanza.attrs.from,\n    from: stanza.attrs.to,\n    id: stanza.attrs.id,\n  });\n}\n\nfunction buildReplyResult(ctx, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"result\";\n  if (child) {\n    reply.append(child);\n  }\n\n  return reply;\n}\n\nfunction buildReplyError(ctx, error, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"error\";\n  if (child) {\n    reply.append(child);\n  }\n\n  reply.append(error);\n  return reply;\n}\n\nfunction buildError(type, condition) {\n  return xml(\"error\", { type }, xml(condition, NS_STANZA));\n}\n\nfunction iqHandler(entity) {\n  return async function iqHandler(ctx, next) {\n    if (!isQuery(ctx)) return next();\n\n    const { stanza } = ctx;\n    const children = stanza.getChildElements();\n    const [child] = children;\n\n    if (!isValidQuery(ctx, children, child)) {\n      return buildReplyError(ctx, buildError(\"modify\", \"bad-request\"), child);\n    }\n\n    ctx.element = child;\n\n    let reply;\n    try {\n      reply = await next();\n    } catch (err) {\n      entity.emit(\"error\", err);\n      reply = buildError(\"cancel\", \"internal-server-error\");\n    }\n\n    if (!reply) {\n      reply = buildError(\"cancel\", \"service-unavailable\");\n    }\n\n    if (reply instanceof xml.Element && reply.is(\"error\")) {\n      return buildReplyError(ctx, reply, child);\n    }\n\n    return buildReplyResult(\n      ctx,\n      reply instanceof xml.Element ? reply : undefined,\n    );\n  };\n}\n\nfunction route(type, ns, name, handler) {\n  return (ctx, next) => {\n    if ((ctx.type !== type) | !ctx.element || !ctx.element.is(name, ns))\n      return next();\n    return handler(ctx, next);\n  };\n}\n\nexport default function iqCallee({ middleware, entity }) {\n  middleware.use(iqHandler(entity));\n\n  return {\n    get(ns, name, handler) {\n      middleware.use(route(\"get\", ns, name, handler));\n    },\n    set(ns, name, handler) {\n      middleware.use(route(\"set\", ns, name, handler));\n    },\n  };\n}\n","function isSecure(uri) {\n  return uri.startsWith(\"https\") || uri.startsWith(\"wss\");\n}\n\nexport function compare(a, b) {\n  let secure;\n  if (isSecure(a.uri) && !isSecure(b.uri)) {\n    secure = -1;\n  } else if (!isSecure(a.uri) && isSecure(b.uri)) {\n    secure = 1;\n  } else {\n    secure = 0;\n  }\n\n  if (secure !== 0) {\n    return secure;\n  }\n\n  let method;\n  if (a.method === b.method) {\n    method = 0;\n  } else if (a.method === \"websocket\") {\n    method = -1;\n  } else if (b.method === \"websocket\") {\n    method = 1;\n  } else if (a.method === \"xbosh\") {\n    method = -1;\n  } else if (b.method === \"xbosh\") {\n    method = 1;\n  } else if (a.method === \"httppoll\") {\n    method = -1;\n  } else if (b.method === \"httppoll\") {\n    method = 1;\n  } else {\n    method = 0;\n  }\n\n  if (method !== 0) {\n    return method;\n  }\n\n  return 0;\n}\n","import parse from \"@xmpp/xml/lib/parse.js\";\n\nimport { compare as compareAltConnections } from \"./alt-connections.js\";\n\nexport function resolve(domain) {\n  // eslint-disable-next-line n/no-unsupported-features/node-builtins\n  return fetch(`https://${domain}/.well-known/host-meta`)\n    .then((res) => res.text())\n    .then((res) => {\n      return parse(res)\n        .getChildren(\"Link\")\n        .filter((link) =>\n          [\n            \"urn:xmpp:alt-connections:websocket\",\n            \"urn:xmpp:alt-connections:httppoll\",\n            \"urn:xmpp:alt-connections:xbosh\",\n          ].includes(link.attrs.rel),\n        )\n        .map(({ attrs }) => ({\n          rel: attrs.rel,\n          href: attrs.href,\n          method: attrs.rel.split(\":\").pop(),\n          uri: attrs.href,\n        }))\n        .toSorted(compareAltConnections);\n    })\n    .catch(() => {\n      return [];\n    });\n}\n","import Parser from \"./Parser.js\";\n\nexport default function parse(data) {\n  const p = new Parser();\n\n  let result = null;\n  let error = null;\n\n  p.on(\"start\", (el) => {\n    result = el;\n  });\n  p.on(\"element\", (el) => {\n    result.append(el);\n  });\n  p.on(\"error\", (err) => {\n    error = err;\n  });\n\n  p.write(data);\n  p.end();\n\n  if (error) {\n    throw error;\n  } else {\n    return result;\n  }\n}\n","import { promise } from \"@xmpp/events\";\n\nimport _resolve from \"./resolve.js\";\n\nasync function fetchURIs(domain) {\n  const result = await _resolve(domain, {\n    srv: [\n      {\n        service: \"xmpps-client\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"xmpp-client\",\n        protocol: \"tcp\",\n      },\n    ],\n  });\n\n  return [\n    // Remove duplicates\n    ...new Set(result.map((record) => record.uri)),\n  ];\n}\n\nfunction filterSupportedURIs(entity, uris) {\n  return uris.filter((uri) => entity._findTransport(uri));\n}\n\nasync function fallbackConnect(entity, uris) {\n  if (uris.length === 0) {\n    throw new Error(\"Couldn't connect\");\n  }\n\n  const uri = uris.shift();\n  const Transport = entity._findTransport(uri);\n\n  if (!Transport) {\n    return fallbackConnect(entity, uris);\n  }\n\n  entity._status(\"connecting\", uri);\n  const params = Transport.prototype.socketParameters(uri);\n  const socket = new Transport.prototype.Socket();\n\n  try {\n    socket.connect(params);\n    await promise(socket, \"connect\");\n  } catch {\n    return fallbackConnect(entity, uris);\n  }\n\n  entity._attachSocket(socket);\n  socket.emit(\"connect\");\n  entity.Transport = Transport;\n  entity.Socket = Transport.prototype.Socket;\n  entity.Parser = Transport.prototype.Parser;\n}\n\nexport default function resolve({ entity }) {\n  const _connect = entity.connect;\n  entity.connect = async function connect(service) {\n    if (!service || /:\\/\\//.test(service)) {\n      return _connect.call(this, service);\n    }\n\n    const uris = filterSupportedURIs(entity, await fetchURIs(service));\n\n    if (uris.length === 0) {\n      throw new Error(\"No compatible transport found.\");\n    }\n\n    try {\n      await fallbackConnect(entity, uris);\n    } catch (err) {\n      await entity.disconnect();\n      entity._status(\"disconnect\");\n      throw err;\n    }\n  };\n}\n\nexport { _resolve as resolve };\n","import * as dns from \"./lib/dns.js\";\nimport * as http from \"./lib/http.js\";\n\nexport default function resolve(...args) {\n  return Promise.all([\n    dns.resolve ? dns.resolve(...args) : Promise.resolve([]),\n    http.resolve(...args),\n  ]).then(([records, endpoints]) => [...records, ...endpoints]);\n}\n\nexport { dns, http };\n","export function encode(string) {\n  return globalThis.btoa(string);\n}\n\nexport function decode(string) {\n  return globalThis.atob(string);\n}\n","import XMPPError from \"@xmpp/error\";\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl-errors\n\nclass SASLError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"SASLError\";\n  }\n}\n\nexport default SASLError;\n","import { encode, decode } from \"@xmpp/base64\";\nimport xml from \"@xmpp/xml\";\nimport { procedure } from \"@xmpp/events\";\n\nimport SASLError from \"./lib/SASLError.js\";\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-sasl\";\n\nexport function getAvailableMechanisms(element, NS, saslFactory) {\n  const offered = new Set(\n    element.getChildren(\"mechanism\", NS).map((m) => m.text()),\n  );\n  const supported = saslFactory._mechs.map(({ name }) => name);\n  return supported.filter((mech) => offered.has(mech));\n}\n\nasync function authenticate({ saslFactory, entity, mechanism, credentials }) {\n  const mech = saslFactory.create([mechanism]);\n  if (!mech) {\n    throw new Error(`SASL: Mechanism ${mechanism} not found.`);\n  }\n\n  const { domain } = entity.options;\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: \"xmpp\",\n    serviceName: domain,\n    ...credentials,\n  };\n\n  await procedure(\n    entity,\n    mech.clientFirst &&\n      xml(\n        \"auth\",\n        { xmlns: NS, mechanism: mech.name },\n        encode(await mech.response(creds)),\n      ),\n    async (element, done) => {\n      if (element.getNS() !== NS) return;\n\n      if (element.name === \"challenge\") {\n        await mech.challenge(decode(element.text()));\n        const resp = await mech.response(creds);\n        await entity.send(\n          xml(\n            \"response\",\n            { xmlns: NS, mechanism: mech.name },\n            typeof resp === \"string\" ? encode(resp) : \"\",\n          ),\n        );\n        return;\n      }\n\n      if (element.name === \"failure\") {\n        throw SASLError.fromElement(element);\n      }\n\n      if (element.name === \"success\") {\n        return done();\n      }\n    },\n  );\n}\n\nexport default function sasl({ streamFeatures, saslFactory }, onAuthenticate) {\n  streamFeatures.use(\"mechanisms\", NS, async ({ entity }, _next, element) => {\n    const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n    if (mechanisms.length === 0) {\n      throw new SASLError(\"SASL: No compatible mechanism available.\");\n    }\n\n    async function done(credentials, mechanism) {\n      await authenticate({\n        saslFactory,\n        entity,\n        mechanism,\n        credentials,\n      });\n    }\n\n    await onAuthenticate(done, mechanisms, null, entity);\n\n    await entity.restart();\n  });\n}\n","import { encode, decode } from \"@xmpp/base64\";\nimport SASLError from \"@xmpp/sasl/lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport { procedure } from \"@xmpp/events\";\nimport { getAvailableMechanisms } from \"@xmpp/sasl\";\n\n// https://xmpp.org/extensions/xep-0388.html\n\nconst NS = \"urn:xmpp:sasl:2\";\n\nasync function authenticate({\n  saslFactory,\n  entity,\n  mechanism,\n  credentials,\n  userAgent,\n  streamFeatures,\n  features,\n}) {\n  const mech = saslFactory.create([mechanism]);\n  if (!mech) {\n    throw new Error(`SASL: Mechanism ${mechanism} not found.`);\n  }\n\n  const { domain } = entity.options;\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: \"xmpp\",\n    serviceName: domain,\n    ...credentials,\n  };\n\n  await procedure(\n    entity,\n    xml(\"authenticate\", { xmlns: NS, mechanism: mech.name }, [\n      mech.clientFirst &&\n        xml(\"initial-response\", {}, encode(await mech.response(creds))),\n      userAgent,\n      ...streamFeatures,\n    ]),\n    async (element, done) => {\n      if (element.getNS() !== NS) return;\n\n      if (element.name === \"challenge\") {\n        await mech.challenge(decode(element.text()));\n        const resp = await mech.response(creds);\n        await entity.send(\n          xml(\n            \"response\",\n            { xmlns: NS, mechanism: mech.name },\n            typeof resp === \"string\" ? encode(resp) : \"\",\n          ),\n        );\n        return;\n      }\n\n      if (element.name === \"failure\") {\n        throw SASLError.fromElement(element);\n      }\n\n      if (element.name === \"continue\") {\n        throw new Error(\"SASL continue is not supported yet\");\n      }\n\n      if (element.name === \"success\") {\n        const additionalData = element.getChild(\"additional-data\")?.text();\n        if (additionalData && mech.final) {\n          await mech.final(decode(additionalData));\n        }\n\n        // https://xmpp.org/extensions/xep-0388.html#success\n        // this is a bare JID, unless resource binding or stream resumption has occurred, in which case it is a full JID.\n        const aid = element.getChildText(\"authorization-identifier\");\n        if (aid) {\n          entity._jid(aid);\n        }\n\n        for (const child of element.getChildElements()) {\n          const feature = features.get(child.getNS());\n          feature?.[1]?.(child);\n        }\n\n        return done();\n      }\n    },\n  );\n}\n\nexport default function sasl2({ streamFeatures, saslFactory }, onAuthenticate) {\n  const features = new Map();\n  let fast;\n\n  streamFeatures.use(\n    \"authentication\",\n    NS,\n    async ({ entity }, _next, element) => {\n      const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n      const streamFeatures = await getStreamFeatures({ element, features });\n      const fast_available = !!fast?.mechanism;\n\n      if (mechanisms.length === 0 && !fast_available) {\n        throw new SASLError(\"SASL: No compatible mechanism available.\");\n      }\n\n      await onAuthenticate(\n        done,\n        mechanisms,\n        fast_available ? fast : null,\n        entity,\n      );\n\n      async function done(credentials, mechanism, userAgent) {\n        // Try fast\n        const success = await fast.auth({\n          authenticate,\n          entity,\n          userAgent,\n          streamFeatures,\n          features,\n          credentials,\n        });\n        if (success) return;\n\n        // fast.auth may mutate streamFeatures to request a token\n\n        // If fast authentication fails, continue and try without\n        await authenticate({\n          entity,\n          userAgent,\n          streamFeatures,\n          features,\n          saslFactory,\n          mechanism,\n          credentials,\n        });\n      }\n    },\n  );\n\n  return {\n    use(ns, req, res) {\n      features.set(ns, [req, res]);\n    },\n    setup({ fast: _fast }) {\n      fast = _fast;\n    },\n  };\n}\n\nasync function getStreamFeatures({ element, features }) {\n  const promises = [];\n\n  const inline = element.getChild(\"inline\");\n  if (!inline) return promises;\n\n  for (const element of inline.getChildElements()) {\n    const xmlns = element.getNS();\n    const feature = features.get(xmlns);\n    if (!feature) continue;\n    promises.push(feature[0](element));\n  }\n\n  return Promise.all(promises);\n}\n","import xml from \"@xmpp/xml\";\n\n/*\n * References\n * https://xmpp.org/rfcs/rfc6120.html#bind\n */\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-bind\";\n\nfunction makeBindElement(resource) {\n  return xml(\"bind\", { xmlns: NS }, resource && xml(\"resource\", {}, resource));\n}\n\nasync function bind(entity, iqCaller, resource) {\n  const result = await iqCaller.set(makeBindElement(resource));\n  const jid = result.getChildText(\"jid\");\n  entity._jid(jid);\n  entity._ready(false);\n  return jid;\n}\n\nfunction route({ iqCaller }, resource) {\n  return async ({ entity }, next) => {\n    resource = typeof resource === \"function\" ? await resource() : resource;\n    await bind(entity, iqCaller, resource);\n    next();\n  };\n}\n\nexport default function resourceBinding(\n  { streamFeatures, iqCaller },\n  resource,\n) {\n  streamFeatures.use(\"bind\", NS, route({ iqCaller }, resource));\n}\n","function date(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return datetime(d).split(\"T\")[0];\n}\n\nfunction time(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return datetime(d).split(\"T\")[1];\n}\n\nfunction datetime(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return new Date(d).toISOString().split(\".\")[0] + \"Z\";\n}\n\nfunction pad(value) {\n  return value < 10 ? \"0\" + value : value;\n}\n\nfunction formatOffset(n) {\n  const sign = n > 0 ? \"-\" : \"+\";\n  const offset = Math.abs(n);\n  return sign + pad(Math.floor(offset / 60)) + \":\" + pad(offset % 60);\n}\n\nfunction offset(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return formatOffset(d.getTimezoneOffset());\n}\n\nexport { date, time, datetime, offset };\n","import XMPPError from \"@xmpp/error\";\nimport { procedure } from \"@xmpp/events\";\n\nimport { NS, makeEnableElement, makeResumeElement } from \"./index.js\";\n\nexport function setupStreamFeature({\n  streamFeatures,\n  sm,\n  entity,\n  resumed,\n  failed,\n  enabled,\n}) {\n  // https://xmpp.org/extensions/xep-0198.html#enable\n  // For client-to-server connections, the client MUST NOT attempt to enable stream management until after it has completed Resource Binding unless it is resuming a previous session\n  streamFeatures.use(\"sm\", NS, async (context, next) => {\n    // Resuming\n    if (sm.id) {\n      try {\n        const element = await resume(entity, sm);\n        await resumed(element);\n        return;\n        // If resumption fails, continue with session establishment\n      } catch {\n        failed();\n      }\n    }\n\n    // Enabling\n\n    // Resource binding first\n    await next();\n\n    const promiseEnable = enable(entity, sm);\n\n    if (sm.outbound_q.length > 0) {\n      throw new Error(\n        \"Stream Management assertion failure, queue should be empty after enable\",\n      );\n    }\n\n    // > The counter for an entity's own sent stanzas is set to zero and started after sending either <enable/> or <enabled/>.\n    // https://xmpp.org/extensions/xep-0198.html#example-7\n    sm.outbound = 0;\n\n    try {\n      const response = await promiseEnable;\n      enabled(response.attrs);\n    } catch {\n      sm.enabled = false;\n      sm.enableSent = false;\n    }\n  });\n}\n\nexport function enable(entity, sm) {\n  return procedure(entity, makeEnableElement({ sm }), (element, done) => {\n    if (element.is(\"enabled\", NS)) {\n      return done(element);\n    } else if (element.is(\"failed\", NS)) {\n      throw XMPPError.fromElement(element);\n    }\n  });\n}\n\nexport async function resume(entity, sm) {\n  return procedure(entity, makeResumeElement({ sm }), (element, done) => {\n    if (element.is(\"resumed\", NS)) {\n      return done(element);\n    } else if (element.is(\"failed\", NS)) {\n      throw XMPPError.fromElement(element);\n    }\n  });\n}\n","import { EventEmitter } from \"@xmpp/events\";\nimport xml from \"@xmpp/xml\";\nimport { datetime } from \"@xmpp/time\";\n\nimport { setupBind2 } from \"./bind2.js\";\nimport { setupSasl2 } from \"./sasl2.js\";\nimport { setupStreamFeature } from \"./stream-feature.js\";\n\n// https://xmpp.org/extensions/xep-0198.html\n\nexport const NS = \"urn:xmpp:sm:3\";\n\nexport function makeEnableElement({ sm }) {\n  return xml(\"enable\", {\n    xmlns: NS,\n    max: sm.preferredMaximum,\n    resume: \"true\",\n  });\n}\n\nexport function makeResumeElement({ sm }) {\n  return xml(\"resume\", { xmlns: NS, h: sm.inbound, previd: sm.id });\n}\n\nexport default function streamManagement({\n  streamFeatures,\n  entity,\n  middleware,\n  bind2,\n  sasl2,\n}) {\n  let timeoutTimeout = null;\n  let requestAckTimeout = null;\n  let requestAckDebounce = null;\n\n  const sm = new EventEmitter();\n  Object.assign(sm, {\n    preferredMaximum: null,\n    enabled: false,\n    enableSent: false,\n    id: \"\",\n    outbound_q: [],\n    outbound: 0,\n    inbound: 0,\n    max: null,\n    timeout: 60_000,\n    requestAckInterval: 30_000,\n    requestAckDebounce: 250,\n  });\n\n  async function sendAck() {\n    try {\n      await entity.send(xml(\"a\", { xmlns: NS, h: sm.inbound }));\n    } catch {}\n  }\n\n  entity.on(\"disconnect\", () => {\n    clearTimeout(timeoutTimeout);\n    clearTimeout(requestAckTimeout);\n    clearTimeout(requestAckDebounce);\n    sm.enabled = false;\n    sm.enableSent = false;\n  });\n\n  // It is RECOMMENDED that initiating entities (usually clients) send an element right before they gracefully close the stream, in order to inform the peer about received stanzas\n  entity.hook(\"close\", async () => {\n    if (!sm.enabled) return;\n    await sendAck();\n  });\n\n  async function resumed(resumed) {\n    sm.enabled = true;\n    ackQueue(+resumed.attrs.h);\n    let q = sm.outbound_q;\n    sm.outbound_q = [];\n    // This will trigger the middleware and re-add to the queue\n    await entity.sendMany(q.map((item) => queueToStanza({ entity, item })));\n    sm.emit(\"resumed\");\n    entity._ready(true);\n    scheduleRequestAck();\n  }\n\n  function failed() {\n    sm.enabled = false;\n    sm.enableSent = false;\n    sm.id = \"\";\n    failQueue();\n  }\n\n  function ackQueue(n) {\n    const oldOutbound = sm.outbound;\n    for (let i = 0; i < +n - oldOutbound; i++) {\n      const item = sm.outbound_q.shift();\n      sm.outbound++;\n      sm.emit(\"ack\", item.stanza);\n    }\n  }\n\n  function failQueue() {\n    let item;\n    while ((item = sm.outbound_q.shift())) {\n      sm.emit(\"fail\", item.stanza);\n    }\n    sm.outbound = 0;\n  }\n\n  function enabled({ id, max }) {\n    sm.enabled = true;\n    sm.id = id;\n    sm.max = max;\n    // > The counter for the received stanzas ('h') is set to zero and started after receiving either <enable/> or <enabled/>.\n    // https://xmpp.org/extensions/xep-0198.html#example-7\n    sm.inbound = 0;\n    scheduleRequestAck();\n  }\n\n  entity.on(\"offline\", () => {\n    failQueue();\n    sm.inbound = 0;\n    sm.enabled = false;\n    sm.enableSent = false;\n    sm.id = \"\";\n  });\n\n  middleware.use(async (context, next) => {\n    const { stanza } = context;\n    clearTimeout(timeoutTimeout);\n    if ([\"presence\", \"message\", \"iq\"].includes(stanza.name)) {\n      sm.inbound += 1;\n    } else if (stanza.is(\"r\", NS)) {\n      // > When an <r/> element (\"request\") is received, the recipient MUST acknowledge it by sending an <a/> element to the sender containing a value of 'h' that is equal to the number of stanzas handled by the recipient of the <r/> element.\n      await sendAck();\n    } else if (stanza.is(\"a\", NS)) {\n      // > When a party receives an <a/> element, it SHOULD keep a record of the 'h' value returned as the sequence number of the last handled outbound stanza for the current stream (and discard the previous value).\n      ackQueue(+stanza.attrs.h);\n    }\n\n    scheduleRequestAck();\n\n    return next();\n  });\n\n  if (bind2) {\n    setupBind2({ bind2, sm, failed, enabled });\n  }\n  if (sasl2) {\n    setupSasl2({ sasl2, sm, failed, resumed });\n  }\n\n  // Periodically send r to check the connection\n  // If a stanza goes out it will cancel this and set a sooner timer\n  function scheduleRequestAck(timeout = sm.requestAckInterval) {\n    clearTimeout(requestAckTimeout);\n\n    if (!sm.enabled) return;\n    if (!timeout) return;\n\n    requestAckTimeout = setTimeout(requestAck, timeout);\n  }\n\n  function requestAck() {\n    clearTimeout(timeoutTimeout);\n    clearTimeout(requestAckTimeout);\n    clearTimeout(requestAckDebounce);\n\n    if (!sm.enabled) return;\n\n    if (sm.timeout) {\n      timeoutTimeout = setTimeout(\n        () => entity.disconnect().catch(() => {}),\n        sm.timeout,\n      );\n    }\n    entity.send(xml(\"r\", { xmlns: NS })).catch(() => {});\n\n    scheduleRequestAck();\n  }\n\n  middleware.filter((context, next) => {\n    const { stanza } = context;\n    if (stanza.is(\"enable\", NS)) {\n      sm.enableSent = true;\n    }\n    if (!sm.enabled && !sm.enableSent) return next();\n    if (![\"presence\", \"message\", \"iq\"].includes(stanza.name)) return next();\n\n    sm.outbound_q.push({ stanza, stamp: datetime() });\n    // Debounce requests so we send only one after a big run of stanza together\n    clearTimeout(requestAckTimeout);\n    clearTimeout(requestAckDebounce);\n    requestAckDebounce = setTimeout(requestAck, sm.requestAckDebounce);\n\n    return next();\n  });\n\n  if (streamFeatures) {\n    setupStreamFeature({\n      streamFeatures,\n      sm,\n      entity,\n      resumed,\n      failed,\n      enabled,\n    });\n  }\n\n  return sm;\n}\n\nfunction queueToStanza({ entity, item }) {\n  const { stanza, stamp } = item;\n  if (\n    stanza.name === \"message\" &&\n    !stanza.getChild(\"delay\", \"urn:xmpp:delay\")\n  ) {\n    stanza.append(\n      xml(\"delay\", {\n        xmlns: \"urn:xmpp:delay\",\n        from: entity.jid.toString(),\n        stamp,\n      }),\n    );\n  }\n  return stanza;\n}\n","import { NS, makeEnableElement } from \"./index.js\";\n\nexport function setupBind2({ bind2, sm, failed, enabled }) {\n  bind2.use(\n    NS,\n    // https://xmpp.org/extensions/xep-0198.html#inline-examples\n    (_element) => {\n      return makeEnableElement({ sm });\n    },\n    async (element) => {\n      if (element.is(\"enabled\")) {\n        enabled(element.attrs);\n      } else if (element.is(\"failed\")) {\n        // const error = StreamError.fromElement(element)\n        failed();\n      }\n    },\n  );\n}\n","import { NS, makeResumeElement } from \"./index.js\";\n\nexport function setupSasl2({ sasl2, sm, failed, resumed }) {\n  sasl2.use(\n    NS,\n    (element) => {\n      if (!element.is(\"sm\")) return;\n      if (sm.id) return makeResumeElement({ sm });\n    },\n    (element) => {\n      if (element.is(\"resumed\")) {\n        resumed(element);\n      } else if (element.is(\"failed\")) {\n        // const error = StreamError.fromElement(element)\n        failed();\n      }\n    },\n  );\n}\n","import xml from \"@xmpp/xml\";\n\nconst NS = \"urn:xmpp:bind:0\";\n\nexport default function bind2({ sasl2, entity }, tag) {\n  const features = new Map();\n\n  sasl2.use(\n    NS,\n    async (element) => {\n      if (!element.is(\"bind\", NS)) return;\n\n      tag = typeof tag === \"function\" ? await tag() : tag;\n\n      const sessionFeatures = await getSessionFeatures({ element, features });\n\n      return xml(\n        \"bind\",\n        { xmlns: \"urn:xmpp:bind:0\" },\n        tag && xml(\"tag\", null, tag),\n        ...sessionFeatures,\n      );\n    },\n    (element) => {\n      if (!element.is(\"bound\")) return;\n      entity._ready(false);\n      for (const child of element.getChildElements()) {\n        const feature = features.get(child.getNS());\n        feature?.[1]?.(child);\n      }\n    },\n  );\n\n  return {\n    use(ns, req, res) {\n      features.set(ns, [req, res]);\n    },\n  };\n}\n\nfunction getSessionFeatures({ element, features }) {\n  const promises = [];\n\n  const inline = element.getChild(\"inline\");\n  if (!inline) return promises;\n\n  for (const element of inline.getChildElements()) {\n    const xmlns = element.attrs.var;\n    const feature = features.get(xmlns);\n    if (!feature) continue;\n    promises.push(feature[0](element));\n  }\n\n  return Promise.all(promises);\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/factory'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/factory'], factory);\n  }\n}(this, function(exports, module, Factory) {\n  \n  exports = module.exports = Factory;\n  exports.Factory = Factory;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n  \n  /**\n   * `Factory` constructor.\n   *\n   * @api public\n   */\n  function Factory() {\n    this._mechs = [];\n  }\n  \n  /**\n   * Utilize the given `mech` with optional `name`, overridding the mechanism's\n   * default name.\n   *\n   * Examples:\n   *\n   *     factory.use(FooMechanism);\n   *\n   *     factory.use('XFOO', FooMechanism);\n   *\n   * @param {String|Mechanism} name\n   * @param {Mechanism} mech\n   * @return {Factory} for chaining\n   * @api public\n   */\n  Factory.prototype.use = function(name, mech) {\n    if (!mech) {\n      mech = name;\n      name = mech.prototype.name;\n    }\n    this._mechs.push({ name: name, mech: mech });\n    return this;\n  };\n  \n  /**\n   * Create a new mechanism from supported list of `mechs`.\n   *\n   * If no mechanisms are supported, returns `null`.\n   *\n   * Examples:\n   *\n   *     var mech = factory.create(['FOO', 'BAR']);\n   *\n   * @param {Array} mechs\n   * @return {Mechanism}\n   * @api public\n   */\n  Factory.prototype.create = function(mechs) {\n    for (var i = 0, len = this._mechs.length; i < len; i++) {\n      for (var j = 0, jlen = mechs.length; j < jlen; j++) {\n        var entry = this._mechs[i];\n        if (entry.name == mechs[j]) {\n          return new entry.mech();\n        }\n      }\n    }\n    return null;\n  };\n\n  exports = module.exports = Factory;\n  \n}));\n","import { EventEmitter } from \"@xmpp/events\";\nimport { getAvailableMechanisms } from \"@xmpp/sasl\";\nimport SASLError from \"@xmpp/sasl/lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport SASLFactory from \"saslmechanisms\";\n\nconst NS = \"urn:xmpp:fast:0\";\n\nexport default function fast({ sasl2, entity }) {\n  const saslFactory = new SASLFactory();\n\n  let token;\n\n  const fast = new EventEmitter();\n  Object.assign(fast, {\n    mechanism: null,\n    mechanisms: [],\n    async saveToken(t) {\n      token = t;\n    },\n    async fetchToken() {\n      return token;\n    },\n    async deleteToken() {\n      token = null;\n    },\n    async save(token) {\n      try {\n        await this.saveToken(token);\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    async fetch() {\n      try {\n        return this.fetchToken();\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    async delete() {\n      try {\n        await this.deleteToken();\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    saslFactory,\n    async auth({\n      authenticate,\n      entity,\n      userAgent,\n      credentials,\n      streamFeatures,\n      features,\n    }) {\n      // Unavailable\n      if (!fast.mechanism) {\n        return false;\n      }\n\n      const { token } = credentials;\n      if (!isTokenValid(token, fast.mechanisms)) {\n        return onInvalidToken();\n      }\n\n      try {\n        await authenticate({\n          saslFactory: fast.saslFactory,\n          mechanism: token.mechanism,\n          credentials: {\n            ...credentials,\n            password: token.token,\n          },\n          streamFeatures: [\n            ...streamFeatures,\n            xml(\"fast\", {\n              xmlns: NS,\n            }),\n          ],\n          entity,\n          userAgent,\n          features,\n        });\n        return true;\n      } catch (err) {\n        if (\n          err instanceof SASLError &&\n          [\"not-authorized\", \"credentials-expired\"].includes(err.condition)\n        ) {\n          return onInvalidToken();\n        }\n        entity.emit(\"error\", err);\n        return false;\n      }\n\n      async function onInvalidToken() {\n        await fast.delete();\n        requestToken(streamFeatures);\n        return false;\n      }\n    },\n  });\n\n  function requestToken(streamFeatures) {\n    streamFeatures.push(\n      xml(\"request-token\", {\n        xmlns: NS,\n        mechanism: fast.mechanism,\n      }),\n    );\n  }\n\n  function reset() {\n    fast.mechanism = null;\n    fast.mechanisms = [];\n  }\n  reset();\n\n  sasl2.use(\n    NS,\n    async (element) => {\n      if (!element.is(\"fast\", NS)) return reset();\n\n      fast.available = true;\n\n      const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n      const mechanism = mechanisms[0];\n\n      if (!mechanism) return reset();\n      fast.mechanisms = mechanisms;\n      fast.mechanism = mechanism;\n\n      // The rest is handled by @xmpp/sasl2\n    },\n    async (element) => {\n      if (element.is(\"token\", NS)) {\n        await fast.save({\n          // The token is bound by the mechanism\n          // > Servers MUST bind tokens to the mechanism selected by the client in its original request, and reject attempts to use them with other mechanisms.\n          mechanism: fast.mechanism,\n          token: element.attrs.token,\n          expiry: element.attrs.expiry,\n        });\n      }\n    },\n  );\n\n  return fast;\n}\n\nexport function isTokenValid(token, mechanisms) {\n  if (!token) return false;\n\n  // Avoid an error round trip if the server does not support the token mechanism anymore\n  if (!mechanisms.includes(token.mechanism)) {\n    return false;\n  }\n\n  // Avoid an error round trip if the token is already expired\n  if (new Date(token.expiry) <= new Date()) {\n    return false;\n  }\n\n  return true;\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * PLAIN `Mechanism` constructor.\n   *\n   * This class implements the PLAIN SASL mechanism.\n   *\n   * The PLAIN SASL mechanism provides support for exchanging a clear-text\n   * username and password.  This mechanism should not be used without adequate\n   * security provided by an underlying transport layer. \n   *\n   * References:\n   *  - [RFC 4616](http://tools.ietf.org/html/rfc4616)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'PLAIN';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using given credential.\n   *\n   * Options:\n   *  - `username`\n   *  - `password`\n   *  - `authzid`   authorization identity (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    var str = '';\n    str += cred.authzid || '';\n    str += '\\0';\n    str += cred.username;\n    str += '\\0';\n    str += cred.password;\n    return str;\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @return {Mechanism} for chaining\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n    return this;\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","import mech from \"sasl-plain\";\n\nexport default function saslPlain(sasl) {\n  sasl.use(mech);\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * ANONYMOUS `Mechanism` constructor.\n   *\n   * This class implements the ANONYMOUS SASL mechanism.\n   *\n   * The ANONYMOUS SASL mechanism provides support for permitting anonymous\n   * access to various services\n   *\n   * References:\n   *  - [RFC 4505](http://tools.ietf.org/html/rfc4505)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'ANONYMOUS';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using optional trace information.\n   *\n   * Options:\n   *  - `trace`  trace information (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    return cred.trace || '';\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","import mech from \"sasl-anonymous\";\n\n/**\n * [XEP-0175: Best Practices for Use of SASL ANONYMOUS](https://xmpp.org/extensions/xep-0175.html)\n * [RFC-4504: Anonymous Simple Authentication and Security Layer (SASL) Mechanism](https://tools.ietf.org/html/rfc4505)\n */\n\nexport default function saslAnonymous(sasl) {\n  sasl.use(mech);\n}\n","/* eslint-disable n/no-unsupported-features/node-builtins */\n\n// https://datatracker.ietf.org/doc/draft-schmaus-kitten-sasl-ht/\n// https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API\n\nexport function Mechanism() {}\n\nMechanism.prototype.Mechanism = Mechanism;\nMechanism.prototype.name = \"HT-SHA-256-NONE\";\nMechanism.prototype.clientFirst = true;\n\nMechanism.prototype.response = async function response({ username, password }) {\n  this.key = await crypto.subtle.importKey(\n    \"raw\",\n    new TextEncoder().encode(password),\n    // https://developer.mozilla.org/en-US/docs/Web/API/HmacImportParams\n    { name: \"HMAC\", hash: \"SHA-256\" },\n    false, // extractable\n    [\"sign\", \"verify\"],\n  );\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    this.key,\n    new TextEncoder().encode(\"Initiator\"),\n  );\n  return `${username}\\0${String.fromCodePoint(...new Uint8Array(signature))}`;\n};\n\nMechanism.prototype.final = async function final(data) {\n  const signature = Uint8Array.from(data, (c) => c.codePointAt(0));\n  // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/verify\n  const result = await crypto.subtle.verify(\n    \"HMAC\",\n    this.key,\n    signature,\n    new TextEncoder().encode(\"Responder\"),\n  );\n  if (result !== true) {\n    throw new Error(\"Responder message from server was wrong\");\n  }\n};\n\nexport default function saslHashedToken(sasl) {\n  sasl.use(Mechanism);\n}\n","const ANONYMOUS = \"ANONYMOUS\";\nconst PLAIN = \"PLAIN\";\n\nexport default function createOnAuthenticate(credentials, userAgent) {\n  return async function onAuthenticate(...args) {\n    if (typeof credentials === \"function\") {\n      await credentials(...args);\n      return;\n    }\n\n    const [authenticate, mechanisms, fast, entity] = args;\n\n    credentials.token ??= await fast?.fetch();\n\n    const mechanism = getMechanism({ mechanisms, entity, credentials });\n    await authenticate(credentials, mechanism, userAgent);\n  };\n}\n\nexport function getMechanism({ mechanisms, entity, credentials }) {\n  if (\n    !credentials?.username &&\n    !credentials?.password &&\n    !credentials?.token &&\n    mechanisms.includes(ANONYMOUS)\n  ) {\n    return ANONYMOUS;\n  }\n\n  if (entity.isSecure()) return mechanisms[0];\n\n  return mechanisms.find((mechanism) => mechanism !== PLAIN);\n}\n","import { xml, jid, Client } from \"@xmpp/client-core\";\nimport _reconnect from \"@xmpp/reconnect\";\nimport _websocket from \"@xmpp/websocket\";\nimport _tcp from \"@xmpp/tcp\";\nimport _tls from \"@xmpp/tls\";\nimport _middleware from \"@xmpp/middleware\";\nimport _streamFeatures from \"@xmpp/stream-features\";\nimport _iqCaller from \"@xmpp/iq/caller.js\";\nimport _iqCallee from \"@xmpp/iq/callee.js\";\nimport _resolve from \"@xmpp/resolve\";\nimport _starttls from \"@xmpp/starttls\";\nimport _sasl2 from \"@xmpp/sasl2\";\nimport _sasl from \"@xmpp/sasl\";\nimport _resourceBinding from \"@xmpp/resource-binding\";\nimport _streamManagement from \"@xmpp/stream-management\";\nimport _bind2 from \"@xmpp/client-core/src/bind2/bind2.js\";\nimport _fast from \"@xmpp/client-core/src/fast/fast.js\";\nimport SASLFactory from \"saslmechanisms\";\nimport scramsha1 from \"@xmpp/sasl-scram-sha-1\";\nimport plain from \"@xmpp/sasl-plain\";\nimport anonymous from \"@xmpp/sasl-anonymous\";\nimport htsha256none from \"@xmpp/sasl-ht-sha-256-none\";\n\nimport createOnAuthenticate from \"./lib/createOnAuthenticate.js\";\nimport getDomain from \"./lib/getDomain.js\";\n\nfunction client(options = {}) {\n  let { resource, credentials, username, password, userAgent, ...params } =\n    options;\n\n  const { domain, service } = params;\n  if (!domain && service) {\n    params.domain = getDomain(service);\n  }\n\n  const entity = new Client(params);\n  if (username && params.domain) {\n    entity.jid = jid(username, params.domain);\n  }\n\n  const reconnect = _reconnect({ entity });\n  const websocket = _websocket({ entity });\n  const tcp = setupIfAvailable(_tcp, { entity });\n  const tls = setupIfAvailable(_tls, { entity });\n\n  const middleware = _middleware({ entity });\n  const streamFeatures = _streamFeatures({ middleware });\n  const iqCaller = _iqCaller({ middleware, entity });\n  const iqCallee = _iqCallee({ middleware, entity });\n  const resolve = _resolve({ entity });\n\n  // SASL mechanisms - order matters and define priority\n  const saslFactory = new SASLFactory();\n  const mechanisms = Object.entries({\n    ...(typeof scramsha1 === \"function\" && { scramsha1 }),\n    plain,\n    anonymous,\n  }).map(([k, v]) => ({ [k]: v(saslFactory) }));\n\n  // eslint-disable-next-line n/no-unsupported-features/node-builtins\n  userAgent ??= xml(\"user-agent\", { id: globalThis.crypto.randomUUID() });\n\n  // Stream features - order matters and define priority\n  const starttls = setupIfAvailable(_starttls, { streamFeatures });\n  const sasl2 = _sasl2(\n    { streamFeatures, saslFactory },\n    createOnAuthenticate(credentials ?? { username, password }, userAgent),\n  );\n\n  const fast = _fast({\n    sasl2,\n    entity,\n  });\n  sasl2.setup({ fast });\n\n  // SASL2 inline features\n  const bind2 = _bind2({ sasl2, entity }, resource);\n\n  // FAST mechanisms - order matters and define priority\n  htsha256none(fast.saslFactory);\n\n  // Stream features - order matters and define priority\n  const sasl = _sasl(\n    { streamFeatures, saslFactory },\n    createOnAuthenticate(credentials ?? { username, password }, userAgent),\n  );\n  const streamManagement = _streamManagement({\n    streamFeatures,\n    entity,\n    middleware,\n    bind2,\n    sasl2,\n  });\n  const resourceBinding = _resourceBinding(\n    { iqCaller, streamFeatures },\n    resource,\n  );\n\n  iqCallee?.get(\"urn:xmpp:ping\", \"ping\", () => {\n    return {};\n  });\n\n  return Object.assign(entity, {\n    entity,\n    reconnect,\n    tcp,\n    websocket,\n    tls,\n    middleware,\n    streamFeatures,\n    iqCaller,\n    iqCallee,\n    resolve,\n    starttls,\n    saslFactory,\n    sasl2,\n    sasl,\n    resourceBinding,\n    streamManagement,\n    mechanisms,\n    bind2,\n    fast,\n  });\n}\n\n// In browsers and react-native some packages are excluded\n// see package.json and https://metrobundler.dev/docs/configuration/#resolvermainfields\n// in which case the default import returns an empty object\nfunction setupIfAvailable(module, ...args) {\n  if (typeof module !== \"function\") {\n    return undefined;\n  }\n\n  return module(...args);\n}\n\nexport { xml, jid, client };\n","export default function getDomain(service) {\n  const domain = service.split(\"://\")[1] || service;\n  return domain.split(\":\")[0].split(\"/\")[0];\n}\n","import ConnectionWebSocket from \"./lib/Connection.js\";\n\nexport default function websocket({ entity }) {\n  entity.transports.push(ConnectionWebSocket);\n}\n","/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation Stream Negotiation\n * https://xmpp.org/extensions/xep-0170.html XEP-0170: Recommended Order of Stream Feature Negotiation\n * https://xmpp.org/registrar/stream-features.html XML Stream Features\n */\n\nexport default function streamFeatures({ middleware }) {\n  function use(name, xmlns, handler) {\n    return middleware.use((ctx, next) => {\n      const { stanza } = ctx;\n      if (!stanza.is(\"features\", \"http://etherx.jabber.org/streams\"))\n        return next();\n      const feature = stanza.getChild(name, xmlns);\n      if (!feature) return next();\n      return handler(ctx, next, feature);\n    });\n  }\n\n  return {\n    use,\n  };\n}\n"],"names":["escapeXMLTable","escapeXMLReplace","match","unescapeXMLTable","unescapeXMLReplace","num","parseInt","slice","String","fromCodePoint","Error","toString","exports","s","replace","result","start","end","previous","indexOf","substring","escape","require","Element","constructor","name","attrs","this","parent","children","setAttrs","is","xmlns","getName","getNS","idx","prefix","findNS","attr","getXmlns","namespaces","m","hasOwnProperty","Object","assign","getAttr","join","getChild","getChildren","child","push","getChildByAttr","val","recursive","getChildrenByAttr","flat","getChildrenByFilter","filter","getText","text","getChildText","getChildElements","root","up","c","cnode","append","nodes","node","prepend","unshift","t","remove","el","length","write","_addChildren","writer","escapeXMLText","k","v","escapeXML","prototype","tree","module","Array","isArray","__source","__self","key","value","entries","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","call","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","EventEmitter","init","emitter","Promise","resolve","reject","errorListener","err","removeListener","resolver","arguments","eventTargetAgnosticAddListener","once","handler","flags","on","addErrorHandlerIfEventEmitter","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","events","existing","warning","create","newListener","emit","warned","w","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","bind","_listeners","unwrap","evlistener","arr","ret","i","unwrapListeners","arrayClone","listenerCount","n","copy","addEventListener","wrapListener","arg","removeEventListener","defineProperty","enumerable","get","set","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","len","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","SaxLtx","super","remainder","parseRemainder","tagName","endTag","selfClosing","attrQuote","attrQuoteChar","attrName","recordStart","_handleTagOpening","data","pos","endRecording","recorded","lt","quot","endcomment","endCDATA","charCodeAt","unescapeXML","substr","cData","startsWith","prevFirst","prevSecond","TimeoutError","timeout","promise","ms","promiseDelay","setTimeout","delay","race","finally","clearTimeout","then","map","WeakMap","onoff","event","rejectEvent","timeoutId","cleanup","onEvent","onError","reason","Deferred","procedure","entity","stanza","done","async","element","send","catch","subscribe","unsubscribe","XMLError","Parser","parser","LtxParser","cursor","onStartElement","onEndElement","onText","str","xml","createElement","detect","local","replaceAll","raw","search","unescape","unescapeXMLText","JID","domain","resource","setDomain","setLocal","setResource","Symbol","toPrimitive","hint","NaN","_domain","_local","getLocal","_resource","bare","equals","other","escaping","toLowerCase","getDomain","getResource","parse","resourceStart","atStart","jid","j","equal","a","b","detectEscape","escapeLocal","unescapeLocal","XMPPError","condition","application","fromElement","second","third","StreamError","parseURI","URI","port","hostname","protocol","URL","parseHost","host","Connection","socketListeners","parserListeners","options","status","socket","isSecure","secure","_streamError","disconnect","_onData","onParserError","_detachParser","onSocketClosed","dirty","_detachSocket","_status","clean","onStreamClosed","_attachSocket","close","connect","_onElement","isStreamError","_onStreamError","isStanza","_onSeeOtherHost","service","includes","parseService","lang","open","_attachParser","_jid","id","_ready","resumed","_closeStream","_closeSocket","promiseOnline","Socket","socketParameters","headerElement","to","header","stop","runHooks","fragment","footer","footerElement","restart","sendReceive","all","string","isNonza","version","NS","hooks","Map","hook_events","Set","hook","assertHookEventName","has","add","unhook","handlers","item","find","Client","transports","Transport","sendMany","_findTransport","from","Reconnect","_timeout","onDisconnect","#onDisconnect","scheduleReconnect","reconnect","CODE","url","uri","WebSocket","errno","code","wasClean","fn","NS_FRAMING","ConnectionWebSocket","elements","test","middleware","next","dispatch","Context","IncomingContext","OutgoingContext","ctx","compose","errorHandler","reply","StanzaError","IQCaller","use","_route","isReply","deferred","delete","request","Math","random","xid","timeoutPromise","_childRequest","buildReply","buildReplyError","buildError","iqHandler","isQuery","isValidQuery","buildReplyResult","route","ns","compare","method","fetch","res","p","link","rel","href","split","toSorted","compareAltConnections","fetchURIs","http","records","endpoints","_resolve","srv","record","fallbackConnect","uris","params","_connect","filterSupportedURIs","encode","globalThis","btoa","decode","atob","SASLError","getAvailableMechanisms","saslFactory","offered","_mechs","mech","sasl","streamFeatures","onAuthenticate","_next","mechanisms","credentials","mechanism","creds","username","password","server","realm","serviceType","serviceName","clientFirst","response","challenge","resp","authenticate","userAgent","features","additionalData","final","aid","feature","sasl2","fast","promises","inline","getStreamFeatures","fast_available","auth","req","setup","_fast","iqCaller","makeBindElement","resourceBinding","datetime","d","Date","toISOString","setupStreamFeature","sm","failed","enabled","makeResumeElement","resume","promiseEnable","makeEnableElement","enable","outbound_q","outbound","enableSent","max","preferredMaximum","h","inbound","previd","streamManagement","bind2","timeoutTimeout","requestAckTimeout","requestAckDebounce","sendAck","ackQueue","q","stamp","queueToStanza","scheduleRequestAck","failQueue","oldOutbound","requestAckInterval","requestAck","_element","setupBind2","setupSasl2","tag","sessionFeatures","var","getSessionFeatures","Factory","mechs","jlen","entry","factory","SASLFactory","token","reset","saveToken","fetchToken","deleteToken","save","expiry","isTokenValid","onInvalidToken","requestToken","available","Mechanism","cred","authzid","chal","saslPlain","trace","saslAnonymous","crypto","subtle","importKey","TextEncoder","hash","signature","sign","Uint8Array","codePointAt","verify","ANONYMOUS","PLAIN","createOnAuthenticate","getMechanism","setupIfAvailable","r","_reconnect","websocket","_websocket","tcp","_tcp","tls","_tls","incoming","outgoing","incomingListener","outgoingListener","_middleware","_streamFeatures","_iqCaller","iqCallee","_iqCallee","plain","anonymous","randomUUID","starttls","_starttls","_sasl2","_bind2","htsha256none","_sasl","_streamManagement","_resourceBinding"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,29,54,55,57,58,60,61]}